<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FocusFlight - Your Realistic Focus Journey</title>
    <style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #7e8ba3 100%);
    min-height: 100vh;
    padding: 20px;
    color: #333;
}

.container {
    max-width: 1400px;
    margin: 0 auto;
}

/* Header Styles */
.header {
    background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
    padding: 20px 40px;
    border-radius: 16px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;
    border: 1px solid rgba(255, 255, 255, 0.3);
}

.header h1 {
    font-size: 2.2em;
    background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    font-weight: 700;
}

.stats {
    display: flex;
    gap: 40px;
}

.stat-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 10px 20px;
    background: rgba(30, 60, 114, 0.05);
    border-radius: 12px;
}

.stat-label {
    font-size: 0.85em;
    color: #666;
    text-transform: uppercase;
    letter-spacing: 1px;
    font-weight: 600;
}

.stat-value {
    font-size: 1.8em;
    font-weight: 700;
    background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-top: 5px;
}

/* Main Content */
.main-content {
    display: grid;
    gap: 24px;
}

/* Booking Steps Container */
.booking-steps {
    background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
    padding: 40px;
    border-radius: 16px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.3);
    min-height: 600px;
    position: relative;
    overflow: hidden;
}

.step-indicator {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
    margin-bottom: 40px;
    padding-bottom: 30px;
    border-bottom: 2px solid #e9ecef;
}

.step-dot {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: #e9ecef;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 1.1em;
    color: #999;
    position: relative;
    transition: all 0.4s ease;
}

.step-dot.active {
    background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
    color: white;
    transform: scale(1.15);
    box-shadow: 0 4px 20px rgba(30, 60, 114, 0.4);
}

.step-dot.completed {
    background: #28a745;
    color: white;
}

.step-connector {
    width: 80px;
    height: 3px;
    background: #e9ecef;
    transition: all 0.4s ease;
}

.step-connector.completed {
    background: #28a745;
}

.step-content {
    opacity: 0;
    transform: translateY(30px);
    animation: fadeInUp 0.6s ease forwards;
}

@keyframes fadeInUp {
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.step-title {
    font-size: 2em;
    color: #1e3c72;
    margin-bottom: 30px;
    text-align: center;
    font-weight: 700;
}

/* Duration Selection */
.duration-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.duration-card {
    background: white;
    border: 3px solid #e9ecef;
    border-radius: 16px;
    padding: 25px;
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: center;
    position: relative;
}

.duration-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
}

.duration-card.selected {
    border-color: #2a5298;
    background: linear-gradient(135deg, rgba(30, 60, 114, 0.05) 0%, rgba(42, 82, 152, 0.05) 100%);
    box-shadow: 0 8px 20px rgba(30, 60, 114, 0.2);
}

.duration-time {
    font-size: 2.5em;
    font-weight: 700;
    color: #1e3c72;
    margin-bottom: 10px;
}

.duration-label {
    font-size: 1.1em;
    color: #666;
    font-weight: 600;
}

/* Seat Selection - Airplane Interior */
.airplane-container {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-radius: 20px;
    padding: 40px 20px;
    margin-bottom: 30px;
    box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.1);
    max-width: 900px;
    margin-left: auto;
    margin-right: auto;
}

.airplane-interior {
    background: white;
    border-radius: 30px 30px 16px 16px;
    padding: 30px 20px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
    position: relative;
    overflow: hidden;
}

.airplane-interior::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 20px;
    background: linear-gradient(90deg, #1e3c72 0%, #2a5298 50%, #1e3c72 100%);
    border-radius: 30px 30px 0 0;
}

.airplane-nose {
    text-align: center;
    font-size: 2em;
    margin-bottom: 20px;
    padding-top: 10px;
}

.seat-class-section {
    margin-bottom: 30px;
    padding: 20px 15px;
    border-radius: 12px;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.5) 0%, rgba(248, 249, 250, 0.5) 100%);
    position: relative;
}

.seat-class-section.locked {
    opacity: 0.6;
    pointer-events: none;
}

.seat-class-section.locked::after {
    content: '🔒 LOCKED';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(220, 53, 69, 0.95);
    color: white;
    padding: 15px 30px;
    border-radius: 12px;
    font-weight: 700;
    font-size: 1.2em;
    letter-spacing: 2px;
    z-index: 10;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
}

.class-header {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 15px;
    margin-bottom: 20px;
    padding: 15px;
    background: linear-gradient(135deg, rgba(30, 60, 114, 0.1) 0%, rgba(42, 82, 152, 0.1) 100%);
    border-radius: 10px;
}

.class-header.first {
    background: linear-gradient(135deg, rgba(255, 215, 0, 0.2) 0%, rgba(255, 193, 7, 0.2) 100%);
}

.class-header.business {
    background: linear-gradient(135deg, rgba(42, 82, 152, 0.15) 0%, rgba(30, 60, 114, 0.15) 100%);
}

.class-header.economy {
    background: linear-gradient(135deg, rgba(108, 117, 125, 0.1) 0%, rgba(73, 80, 87, 0.1) 100%);
}

.class-title {
    font-size: 1.5em;
    font-weight: 700;
    color: #1e3c72;
}

.class-multiplier {
    background: #28a745;
    color: white;
    padding: 5px 15px;
    border-radius: 20px;
    font-size: 0.9em;
    font-weight: 600;
}

.seat-rows {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.seat-row {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 5px 0;
}

.row-number {
    width: 30px;
    text-align: center;
    font-weight: 700;
    color: #666;
    font-size: 0.9em;
}

.seat-group {
    display: flex;
    gap: 8px;
}

.aisle {
    width: 40px;
    min-width: 40px;
}

.seat {
    width: 45px;
    height: 45px;
    border-radius: 8px 8px 4px 4px;
    border: 2px solid #dee2e6;
    background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.75em;
    font-weight: 600;
    color: #666;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

.seat.first {
    width: 55px;
    height: 55px;
    font-size: 0.85em;
    background: linear-gradient(135deg, #fff8e1 0%, #ffeaa7 100%);
    border-color: #ffc107;
}

.seat.business {
    width: 50px;
    height: 50px;
    font-size: 0.8em;
    background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
    border-color: #2196f3;
}

.seat.economy {
    background: linear-gradient(135deg, #ffffff 0%, #f1f3f5 100%);
    border-color: #ced4da;
}

.seat.available:hover {
    transform: translateY(-3px) scale(1.08);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    border-color: #2a5298;
}

.seat.selected {
    background: linear-gradient(135deg, #2a5298 0%, #1e3c72 100%);
    border-color: #1e3c72;
    color: white;
    transform: scale(1.1);
    box-shadow: 0 5px 20px rgba(30, 60, 114, 0.4);
    animation: seatPulse 1.5s ease-in-out infinite;
}

@keyframes seatPulse {
    0%, 100% {
        box-shadow: 0 5px 20px rgba(30, 60, 114, 0.4);
    }
    50% {
        box-shadow: 0 5px 30px rgba(30, 60, 114, 0.6);
    }
}

.seat.occupied {
    background: linear-gradient(135deg, #e9ecef 0%, #ced4da 100%);
    border-color: #adb5bd;
    cursor: not-allowed;
    color: #adb5bd;
}

.seat.occupied::after {
    content: '✕';
    position: absolute;
    font-size: 1.2em;
    color: #6c757d;
}

.seat::before {
    content: attr(data-label);
    position: absolute;
    font-size: 0.7em;
    font-weight: 600;
    opacity: 0.8;
}

.seat-tooltip {
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%) translateY(-10px);
    background: rgba(0, 0, 0, 0.9);
    color: white;
    padding: 10px 15px;
    border-radius: 8px;
    font-size: 0.85em;
    white-space: nowrap;
    pointer-events: none;
    opacity: 0;
    transition: all 0.3s ease;
    z-index: 100;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
}

.seat-tooltip::after {
    content: '';
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
    border: 6px solid transparent;
    border-top-color: rgba(0, 0, 0, 0.9);
}

.seat:hover .seat-tooltip {
    opacity: 1;
    transform: translateX(-50%) translateY(-5px);
}

.seat-legend {
    display: flex;
    justify-content: center;
    gap: 30px;
    margin-top: 30px;
    padding: 20px;
    background: rgba(248, 249, 250, 0.5);
    border-radius: 12px;
}

.legend-item {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 0.9em;
}

.legend-seat {
    width: 35px;
    height: 35px;
    border-radius: 6px 6px 3px 3px;
    border: 2px solid;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.7em;
}

.legend-seat.available {
    background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
    border-color: #dee2e6;
}

.legend-seat.selected {
    background: linear-gradient(135deg, #2a5298 0%, #1e3c72 100%);
    border-color: #1e3c72;
    color: white;
}

.legend-seat.occupied {
    background: linear-gradient(135deg, #e9ecef 0%, #ced4da 100%);
    border-color: #adb5bd;
    color: #adb5bd;
}

.selected-seat-info {
    text-align: center;
    padding: 20px;
    margin-top: 20px;
    background: linear-gradient(135deg, rgba(30, 60, 114, 0.1) 0%, rgba(42, 82, 152, 0.1) 100%);
    border-radius: 12px;
    border: 2px solid #2a5298;
}

.selected-seat-info h3 {
    color: #1e3c72;
    font-size: 1.3em;
    margin-bottom: 10px;
}

.selected-seat-info p {
    color: #495057;
    font-size: 1.1em;
    font-weight: 600;
}

.selected-seat-info .seat-perks {
    margin-top: 10px;
    font-size: 0.95em;
    color: #28a745;
}

/* Route Selection */
.routes-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.route-card {
    background: white;
    border: 3px solid #e9ecef;
    border-radius: 16px;
    padding: 25px;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
}

.route-card:hover:not(.locked) {
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
}

.route-card.selected {
    border-color: #2a5298;
    background: linear-gradient(135deg, rgba(30, 60, 114, 0.05) 0%, rgba(42, 82, 152, 0.05) 100%);
    box-shadow: 0 8px 20px rgba(30, 60, 114, 0.2);
}

.route-card.locked {
    opacity: 0.5;
    cursor: not-allowed;
}

.route-card.recommended {
    border-color: #ffc107;
    background: linear-gradient(135deg, rgba(255, 193, 7, 0.1) 0%, rgba(255, 193, 7, 0.05) 100%);
}

.route-card.recommended::before {
    content: "⭐ RECOMMENDED";
    position: absolute;
    top: -10px;
    right: 15px;
    background: #ffc107;
    color: #333;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.75em;
    font-weight: 700;
    letter-spacing: 1px;
}

.route-cities {
    font-size: 1.5em;
    font-weight: 700;
    color: #1e3c72;
    margin-bottom: 15px;
    text-align: center;
}

.route-arrow {
    color: #2a5298;
    margin: 0 10px;
}

.route-info {
    display: flex;
    justify-content: space-around;
    gap: 15px;
    margin-top: 15px;
    padding-top: 15px;
    border-top: 2px solid #e9ecef;
}

.route-info-item {
    text-align: center;
}

.route-info-label {
    font-size: 0.8em;
    color: #999;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 5px;
}

.route-info-value {
    font-size: 1.1em;
    color: #333;
    font-weight: 700;
}

/* Buttons */
.btn {
    padding: 18px 40px;
    border: none;
    border-radius: 12px;
    font-size: 1.2em;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 1px;
    display: inline-block;
}

.btn-primary {
    background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
    color: white;
    box-shadow: 0 6px 20px rgba(30, 60, 114, 0.3);
}

.btn-primary:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 30px rgba(30, 60, 114, 0.4);
}

.btn-secondary {
    background: #6c757d;
    color: white;
}

.btn-secondary:hover {
    background: #5a6268;
    transform: translateY(-2px);
}

.btn-danger {
    background: #dc3545;
    color: white;
}

.btn-danger:hover {
    background: #c82333;
}

.btn-group {
    display: flex;
    gap: 20px;
    justify-content: center;
    margin-top: 30px;
}

/* Flight Tracker Section */
.flight-tracker {
    background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
    padding: 40px;
    border-radius: 16px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.3);
}

.flight-tracker.hidden {
    display: none;
}

.flight-header {
    text-align: center;
    margin-bottom: 30px;
}

.flight-route-title {
    font-size: 2.5em;
    color: #1e3c72;
    font-weight: 700;
    margin-bottom: 10px;
}

.flight-details {
    display: flex;
    justify-content: center;
    gap: 40px;
    font-size: 1.1em;
    color: #666;
}

/* Globe Visualization */
.globe-container {
    background: linear-gradient(135deg, #0a1929 0%, #1a2332 50%, #2a3f5f 100%);
    border-radius: 16px;
    padding: 30px;
    margin-bottom: 30px;
    position: relative;
    overflow: hidden;
}

.globe-container::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: 
        radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 70% 70%, rgba(255, 255, 255, 0.05) 0%, transparent 50%);
    pointer-events: none;
}

#globeMap {
    width: 100%;
    height: auto;
    filter: drop-shadow(0 10px 30px rgba(0, 0, 0, 0.3));
}

/* Timer */
.timer-section {
    margin-bottom: 30px;
}

.timer-display {
    font-size: 5em;
    font-weight: 700;
    text-align: center;
    background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 20px;
    font-variant-numeric: tabular-nums;
}

.progress-container {
    width: 100%;
    height: 40px;
    background: #e9ecef;
    border-radius: 20px;
    overflow: hidden;
    position: relative;
    box-shadow: inset 0 2px 6px rgba(0, 0, 0, 0.1);
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #28a745 0%, #20c997 100%);
    width: 0%;
    transition: width 0.3s ease;
    border-radius: 20px;
    position: relative;
    overflow: hidden;
}

.progress-fill::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(
        90deg,
        transparent,
        rgba(255, 255, 255, 0.3),
        transparent
    );
    animation: shimmer 2s infinite;
}

@keyframes shimmer {
    0% {
        transform: translateX(-100%);
    }
    100% {
        transform: translateX(100%);
    }
}

.progress-percentage {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-weight: 700;
    color: #333;
    font-size: 1.1em;
}

/* Controls */
.controls {
    display: flex;
    gap: 20px;
    justify-content: center;
}

/* Lower sections */
.info-sections {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 24px;
}

.info-section {
    background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
    padding: 30px;
    border-radius: 16px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.3);
}

.info-section h2 {
    color: #1e3c72;
    margin-bottom: 20px;
    font-size: 1.8em;
    font-weight: 700;
}

.achievements-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 15px;
}

.achievement-card {
    background: white;
    border: 2px solid #e9ecef;
    border-radius: 12px;
    padding: 20px;
    text-align: center;
    transition: all 0.3s ease;
}

.achievement-card.unlocked {
    background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
    border-color: #ffc107;
}

.achievement-card.locked {
    opacity: 0.4;
}

.achievement-icon {
    font-size: 2.5em;
    margin-bottom: 10px;
}

.achievement-name {
    font-weight: 700;
    margin-bottom: 5px;
    color: #1e3c72;
}

.achievement-desc {
    font-size: 0.85em;
    color: #666;
}

.cities-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
    gap: 15px;
}

.city-card {
    background: white;
    border: 2px solid #e9ecef;
    border-radius: 12px;
    padding: 15px;
    text-align: center;
    transition: all 0.3s ease;
}

.city-card.unlocked {
    background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%);
    border-color: #17a2b8;
}

.city-card.locked {
    opacity: 0.4;
}

.city-icon {
    font-size: 2em;
    margin-bottom: 8px;
}

.city-name {
    font-weight: 700;
    color: #1e3c72;
    margin-bottom: 5px;
}

.city-requirement {
    font-size: 0.8em;
    color: #666;
}

/* Responsive Design */
@media (max-width: 1024px) {
    .info-sections {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 768px) {
    .header {
        flex-direction: column;
        gap: 20px;
    }

    .stats {
        flex-direction: row;
        flex-wrap: wrap;
        gap: 15px;
        justify-content: center;
    }

    .duration-grid,
    .seat-grid,
    .routes-grid {
        grid-template-columns: 1fr;
    }

    .timer-display {
        font-size: 3.5em;
    }

    .controls {
        flex-direction: column;
    }

    .btn {
        width: 100%;
    }

    .step-indicator {
        overflow-x: auto;
        justify-content: flex-start;
        padding-bottom: 20px;
    }
}

/* Animations */
@keyframes slideInRight {
    from {
        opacity: 0;
        transform: translateX(50px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

@keyframes slideInLeft {
    from {
        opacity: 0;
        transform: translateX(-50px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

.slide-in-right {
    animation: slideInRight 0.6s ease forwards;
}

.slide-in-left {
    animation: slideInLeft 0.6s ease forwards;
}

@keyframes pulse {
    0%, 100% {
        transform: scale(1);
    }
    50% {
        transform: scale(1.05);
    }
}

.pulse {
    animation: pulse 2s infinite;
}

/* Hidden utility */
.hidden {
    display: none !important;
}
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>✈️ FocusFlight</h1>
            <div class="stats">
                <div class="stat-item">
                    <span class="stat-label">Total Miles</span>
                    <span class="stat-value" id="totalMiles">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Flights</span>
                    <span class="stat-value" id="flightsCompleted">0</span>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Booking Steps -->
            <section class="booking-steps" id="bookingSteps">
                <!-- Step Indicator -->
                <div class="step-indicator">
                    <div class="step-dot active" id="step1Dot">1</div>
                    <div class="step-connector" id="connector1"></div>
                    <div class="step-dot" id="step2Dot">2</div>
                    <div class="step-connector" id="connector2"></div>
                    <div class="step-dot" id="step3Dot">3</div>
                </div>

                <!-- Step 1: Duration Selection -->
                <div class="step-content" id="step1Content">
                    <h2 class="step-title">Select Your Focus Duration</h2>
                    <div class="duration-grid" id="durationGrid"></div>
                    <div class="btn-group">
                        <button class="btn btn-primary" id="continueToSeats">Continue to Seat Selection</button>
                    </div>
                </div>

                <!-- Step 2: Seat Selection -->
                <div class="step-content hidden" id="step2Content">
                    <h2 class="step-title">Select Your Seat</h2>
                    <div class="airplane-container">
                        <div class="airplane-interior">
                            <div class="airplane-nose">✈️</div>
                            <div id="seatMap"></div>
                            <div class="seat-legend">
                                <div class="legend-item">
                                    <div class="legend-seat available"></div>
                                    <span>Available</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-seat selected"></div>
                                    <span>Selected</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-seat occupied">✕</div>
                                    <span>Occupied</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="selectedSeatInfo" class="selected-seat-info" style="display: none;">
                        <h3>Selected Seat</h3>
                        <p id="seatDetails"></p>
                        <div class="seat-perks" id="seatPerks"></div>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-secondary" id="backToDuration">Back</button>
                        <button class="btn btn-primary" id="continueToRoutes">Continue to Route Selection</button>
                    </div>
                </div>

                <!-- Step 3: Route Selection -->
                <div class="step-content hidden" id="step3Content">
                    <h2 class="step-title">Select Your Flight Route</h2>
                    <div class="routes-grid" id="routesGrid"></div>
                    <div class="btn-group">
                        <button class="btn btn-secondary" id="backToSeats">Back</button>
                        <button class="btn btn-primary" id="startFlight">Start Your Flight ✈️</button>
                    </div>
                </div>
            </section>

            <!-- Flight Tracker -->
            <section class="flight-tracker hidden" id="flightTracker">
                <div class="flight-header">
                    <h2 class="flight-route-title" id="flightRouteTitle">New York → Boston</h2>
                    <div class="flight-details">
                        <span><strong>Class:</strong> <span id="flightClass">Economy</span></span>
                        <span><strong>Distance:</strong> <span id="flightDistance">306 km</span></span>
                        <span><strong>Miles to Earn:</strong> <span id="milesToEarn">25</span></span>
                    </div>
                </div>

                <!-- Globe Visualization -->
                <div class="globe-container">
                    <svg id="globeMap" viewBox="0 0 800 500">
                        <!-- Globe background -->
                        <defs>
                            <radialGradient id="globeGradient" cx="50%" cy="50%">
                                <stop offset="0%" style="stop-color:#4a90e2;stop-opacity:1" />
                                <stop offset="70%" style="stop-color:#2c5aa0;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#1a3a6e;stop-opacity:1" />
                            </radialGradient>
                            <radialGradient id="globeHighlight" cx="35%" cy="35%">
                                <stop offset="0%" style="stop-color:#ffffff;stop-opacity:0.3" />
                                <stop offset="50%" style="stop-color:#ffffff;stop-opacity:0" />
                            </radialGradient>
                        </defs>
                        
                        <!-- Globe sphere -->
                        <circle cx="400" cy="250" r="220" fill="url(#globeGradient)" />
                        <circle cx="400" cy="250" r="220" fill="url(#globeHighlight)" />
                        
                        <!-- Latitude lines -->
                        <ellipse cx="400" cy="250" rx="220" ry="220" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="1"/>
                        <ellipse cx="400" cy="250" rx="220" ry="110" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="1"/>
                        <ellipse cx="400" cy="250" rx="220" ry="44" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="1"/>
                        <line x1="180" y1="250" x2="620" y2="250" stroke="rgba(255,255,255,0.15)" stroke-width="2"/>
                        
                        <!-- Longitude lines -->
                        <ellipse cx="400" cy="250" rx="110" ry="220" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="1"/>
                        <ellipse cx="400" cy="250" rx="44" ry="220" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="1"/>
                        <line x1="400" y1="30" x2="400" y2="470" stroke="rgba(255,255,255,0.15)" stroke-width="2"/>
                        
                        <!-- Continental outlines (simplified) -->
                        <g id="continents" fill="#3d7e3d" opacity="0.7">
                            <!-- North America (simplified) -->
                            <path d="M 180,120 Q 220,100 260,110 Q 300,120 320,140 Q 340,160 350,180 Q 360,200 350,220 Q 340,240 320,250 Q 300,260 280,270 Q 260,280 240,280 Q 220,280 200,270 Q 180,260 170,240 Q 160,220 165,200 Q 170,180 175,160 Q 180,140 180,120 Z"/>
                            
                            <!-- Europe (simplified) -->
                            <path d="M 420,130 Q 440,125 455,135 Q 470,145 475,160 Q 480,175 475,190 Q 470,205 455,210 Q 440,215 425,210 Q 410,205 405,190 Q 400,175 405,160 Q 410,145 420,130 Z"/>
                            
                            <!-- South America (simplified) -->
                            <path d="M 300,280 Q 310,300 315,320 Q 320,340 318,360 Q 316,380 308,395 Q 300,410 285,415 Q 270,420 260,410 Q 250,400 245,385 Q 240,370 242,350 Q 244,330 250,310 Q 256,290 270,285 Q 284,280 300,280 Z"/>
                            
                            <!-- Africa (simplified) -->
                            <path d="M 440,220 Q 455,240 465,260 Q 475,280 478,300 Q 481,320 475,340 Q 469,360 455,370 Q 441,380 425,375 Q 409,370 400,355 Q 391,340 390,320 Q 389,300 395,280 Q 401,260 410,245 Q 419,230 440,220 Z"/>
                        </g>
                        
                        <!-- Flight path (will be drawn dynamically) -->
                        <path id="flightPath" fill="none" stroke="#ffc107" stroke-width="3" stroke-dasharray="10,5" opacity="0.8"/>
                        
                        <!-- Departure marker -->
                        <g id="departureMarker">
                            <circle cx="0" cy="0" r="8" fill="#28a745" stroke="white" stroke-width="2"/>
                            <text x="0" y="-15" text-anchor="middle" fill="white" font-size="14" font-weight="bold" id="departureLabel">Departure</text>
                        </g>
                        
                        <!-- Arrival marker -->
                        <g id="arrivalMarker">
                            <circle cx="0" cy="0" r="8" fill="#dc3545" stroke="white" stroke-width="2"/>
                            <text x="0" y="-15" text-anchor="middle" fill="white" font-size="14" font-weight="bold" id="arrivalLabel">Arrival</text>
                        </g>
                        
                        <!-- Plane -->
                        <text id="plane" x="0" y="0" text-anchor="middle" font-size="32" transform="rotate(0)">✈️</text>
                    </svg>
                </div>

                <!-- Timer -->
                <div class="timer-section">
                    <div class="timer-display" id="timerDisplay">25:00</div>
                    <div class="progress-container">
                        <div class="progress-fill" id="progressFill"></div>
                        <span class="progress-percentage" id="progressPercentage">0%</span>
                    </div>
                </div>

                <!-- Controls -->
                <div class="controls">
                    <button class="btn btn-secondary" id="pauseFlight">⏸️ Pause</button>
                    <button class="btn btn-danger" id="cancelFlight">✕ Cancel Flight</button>
                </div>
            </section>

            <!-- Info Sections -->
            <div class="info-sections">
                <!-- Achievements -->
                <div class="info-section">
                    <h2>🏆 Achievements</h2>
                    <div class="achievements-grid" id="achievementsGrid"></div>
                </div>

                <!-- Cities -->
                <div class="info-section">
                    <h2>🌍 Cities</h2>
                    <div class="cities-grid" id="citiesGrid"></div>
                </div>
            </div>
        </main>
    </div>

    <script>
// Real-world flight routes with accurate data
const REAL_ROUTES = {
    // Short flights (15-25 min realistic)
    'jfk-bos': { 
        from: 'New York', 
        to: 'Boston', 
        fromCity: 'newyork', 
        toCity: 'boston',
        distance: 306,  // km
        flightTime: 65, // minutes (realistic flight time)
        departCoords: [290, 170],
        arrivalCoords: [320, 155]
    },
    'lax-sfo': { 
        from: 'Los Angeles', 
        to: 'San Francisco', 
        fromCity: 'losangeles', 
        toCity: 'sanfrancisco',
        distance: 543,
        flightTime: 85,
        departCoords: [200, 190],
        arrivalCoords: [180, 170]
    },
    'mia-fll': {
        from: 'Miami',
        to: 'Fort Lauderdale',
        fromCity: 'miami',
        toCity: 'fortlauderdale',
        distance: 42,
        flightTime: 30,
        departCoords: [310, 260],
        arrivalCoords: [315, 257]
    },
    
    // Medium flights (30-45 min realistic)
    'ord-dtw': { 
        from: 'Chicago', 
        to: 'Detroit', 
        fromCity: 'chicago', 
        toCity: 'detroit',
        distance: 382,
        flightTime: 75,
        departCoords: [270, 180],
        arrivalCoords: [295, 175]
    },
    'sea-pdx': { 
        from: 'Seattle', 
        to: 'Portland', 
        fromCity: 'seattle', 
        toCity: 'portland',
        distance: 233,
        flightTime: 55,
        departCoords: [165, 155],
        arrivalCoords: [170, 165]
    },
    'dfw-iah': {
        from: 'Dallas',
        to: 'Houston',
        fromCity: 'dallas',
        toCity: 'houston',
        distance: 362,
        flightTime: 70,
        departCoords: [250, 220],
        arrivalCoords: [265, 235]
    },
    
    // Longer domestic (60 min)
    'jfk-mia': {
        from: 'New York',
        to: 'Miami',
        fromCity: 'newyork',
        toCity: 'miami',
        distance: 1759,
        flightTime: 175,
        departCoords: [290, 170],
        arrivalCoords: [310, 260]
    },
    'lax-jfk': {
        from: 'Los Angeles',
        to: 'New York',
        fromCity: 'losangeles',
        toCity: 'newyork',
        distance: 3974,
        flightTime: 320,
        departCoords: [200, 190],
        arrivalCoords: [290, 170]
    },
    
    // International (90-120 min)
    'jfk-lhr': { 
        from: 'New York', 
        to: 'London', 
        fromCity: 'newyork', 
        toCity: 'london',
        distance: 5585,
        flightTime: 420,
        departCoords: [290, 170],
        arrivalCoords: [430, 145]
    },
    'jfk-cdg': {
        from: 'New York',
        to: 'Paris',
        fromCity: 'newyork',
        toCity: 'paris',
        distance: 5837,
        flightTime: 440,
        departCoords: [290, 170],
        arrivalCoords: [445, 150]
    }
};

// FocusFlight Application
class FocusFlight {
    constructor() {
        this.data = {
            totalMiles: 0,
            flightsCompleted: 0,
            achievements: [],
            unlockedCities: ['newyork', 'boston', 'losangeles', 'sanfrancisco', 'chicago', 'detroit'],
            unlockedSeats: ['economy', 'business']
        };
        
        this.session = {
            active: false,
            paused: false,
            duration: 25,
            elapsed: 0,
            seatClass: 'economy',
            route: 'jfk-bos',
            timer: null,
            startTime: null,
            currentStep: 1,
            selectedDuration: 25,
            selectedSeat: 'economy',
            selectedSeatLabel: '6A',
            selectedRoute: null
        };

        this.achievements = [
            { id: 'first-flight', name: 'First Flight', desc: 'Complete your first focus session', icon: '🎯', requirement: 1, type: 'flights' },
            { id: 'frequent-flyer', name: 'Frequent Flyer', desc: 'Complete 10 flights', icon: '✈️', requirement: 10, type: 'flights' },
            { id: 'globe-trotter', name: 'Globe Trotter', desc: 'Complete 25 flights', icon: '🌍', requirement: 25, type: 'flights' },
            { id: 'mile-high-club', name: 'Mile High Club', desc: 'Earn 100 miles', icon: '💯', requirement: 100, type: 'miles' },
            { id: 'sky-master', name: 'Sky Master', desc: 'Earn 500 miles', icon: '⭐', requirement: 500, type: 'miles' },
            { id: 'aviation-legend', name: 'Aviation Legend', desc: 'Earn 1000 miles', icon: '👑', requirement: 1000, type: 'miles' }
        ];

        this.cities = [
            { id: 'newyork', name: 'New York', icon: '🗽', requirement: 0 },
            { id: 'boston', name: 'Boston', icon: '🏛️', requirement: 0 },
            { id: 'sanfrancisco', name: 'San Francisco', icon: '🌉', requirement: 0 },
            { id: 'losangeles', name: 'Los Angeles', icon: '🌴', requirement: 0 },
            { id: 'chicago', name: 'Chicago', icon: '🏙️', requirement: 0 },
            { id: 'detroit', name: 'Detroit', icon: '🚗', requirement: 0 },
            { id: 'fortlauderdale', name: 'Fort Lauderdale', icon: '🏖️', requirement: 100 },
            { id: 'miami', name: 'Miami', icon: '🌺', requirement: 100 },
            { id: 'seattle', name: 'Seattle', icon: '☕', requirement: 250 },
            { id: 'portland', name: 'Portland', icon: '🌲', requirement: 250 },
            { id: 'dallas', name: 'Dallas', icon: '🤠', requirement: 300 },
            { id: 'houston', name: 'Houston', icon: '🚀', requirement: 300 },
            { id: 'london', name: 'London', icon: '🇬🇧', requirement: 500 },
            { id: 'paris', name: 'Paris', icon: '🇫🇷', requirement: 500 }
        ];

        this.durations = [
            { value: 15, label: 'Quick Sprint', category: 'short' },
            { value: 25, label: 'Pomodoro', category: 'short' },
            { value: 30, label: 'Half Hour', category: 'medium' },
            { value: 45, label: 'Power Hour', category: 'medium' },
            { value: 60, label: 'Deep Work', category: 'long' },
            { value: 90, label: 'Extended', category: 'long' },
            { value: 120, label: 'Ultra Focus', category: 'transcontinental' }
        ];

        this.seats = [
            { id: 'economy', name: 'Economy', icon: '💺', multiplier: 1, requirement: 0 },
            { id: 'business', name: 'Business', icon: '🛋️', multiplier: 1.5, requirement: 0 },
            { id: 'first', name: 'First Class', icon: '👑', multiplier: 2, requirement: 500 }
        ];

        this.init();
    }

    init() {
        this.loadData();
        this.updateUI();
        this.renderDurations();
        this.renderSeats();
        this.renderAchievements();
        this.renderCities();
        this.attachEventListeners();
        this.checkUnlocks();
    }

    loadData() {
        const saved = localStorage.getItem('focusFlightV2');
        if (saved) {
            try {
                const parsed = JSON.parse(saved);
                this.data = { ...this.data, ...parsed };
            } catch (e) {
                console.error('Error loading data:', e);
            }
        }
    }

    saveData() {
        localStorage.setItem('focusFlightV2', JSON.stringify(this.data));
    }

    updateUI() {
        document.getElementById('totalMiles').textContent = this.data.totalMiles;
        document.getElementById('flightsCompleted').textContent = this.data.flightsCompleted;
    }

    attachEventListeners() {
        document.getElementById('continueToSeats').addEventListener('click', () => this.goToStep(2));
        document.getElementById('backToDuration').addEventListener('click', () => this.goToStep(1));
        document.getElementById('continueToRoutes').addEventListener('click', () => this.goToStep(3));
        document.getElementById('backToSeats').addEventListener('click', () => this.goToStep(2));
        document.getElementById('startFlight').addEventListener('click', () => this.startFlight());
        document.getElementById('pauseFlight').addEventListener('click', () => this.togglePause());
        document.getElementById('cancelFlight').addEventListener('click', () => this.cancelFlight());
    }

    renderDurations() {
        const grid = document.getElementById('durationGrid');
        grid.innerHTML = '';
        
        this.durations.forEach(duration => {
            const card = document.createElement('div');
            card.className = 'duration-card';
            if (duration.value === this.session.selectedDuration) {
                card.classList.add('selected');
            }
            
            card.innerHTML = `
                <div class="duration-time">${duration.value}<span style="font-size: 0.5em;">min</span></div>
                <div class="duration-label">${duration.label}</div>
            `;
            
            card.addEventListener('click', () => {
                this.session.selectedDuration = duration.value;
                document.querySelectorAll('.duration-card').forEach(c => c.classList.remove('selected'));
                card.classList.add('selected');
            });
            
            grid.appendChild(card);
        });
    }

    renderSeats() {
        const seatMap = document.getElementById('seatMap');
        seatMap.innerHTML = '';
        
        // Define seat configuration for each class
        const seatConfig = {
            first: {
                rows: [1, 2],
                columns: ['A', 'C', 'D', 'F'],
                perks: ['Extra legroom', 'Premium meals', '2x miles'],
                multiplier: 2,
                requirement: 500
            },
            business: {
                rows: [3, 4, 5],
                columns: ['A', 'B', 'C', 'D', 'E', 'F'],
                perks: ['Priority boarding', 'Lounge access', '1.5x miles'],
                multiplier: 1.5,
                requirement: 0
            },
            economy: {
                rows: [6, 7, 8, 9, 10],
                columns: ['A', 'B', 'C', 'D', 'E', 'F'],
                perks: ['Standard service', '1x miles'],
                multiplier: 1,
                requirement: 0
            }
        };
        
        // Generate random occupied seats (for realism)
        const occupiedSeats = this.generateOccupiedSeats();
        
        // Render each class section
        ['first', 'business', 'economy'].forEach(classType => {
            const config = seatConfig[classType];
            const unlocked = this.data.totalMiles >= config.requirement;
            
            const section = document.createElement('div');
            section.className = `seat-class-section ${classType}${!unlocked ? ' locked' : ''}`;
            
            const header = document.createElement('div');
            header.className = `class-header ${classType}`;
            header.innerHTML = `
                <span class="class-title">${classType === 'first' ? '👑 First Class' : classType === 'business' ? '🛋️ Business Class' : '💺 Economy Class'}</span>
                <span class="class-multiplier">${config.multiplier}x Miles</span>
                ${!unlocked ? `<span style="margin-left: auto; color: #dc3545; font-weight: 700;">🔒 ${config.requirement} miles required</span>` : ''}
            `;
            section.appendChild(header);
            
            const rows = document.createElement('div');
            rows.className = 'seat-rows';
            
            config.rows.forEach(rowNum => {
                const row = document.createElement('div');
                row.className = 'seat-row';
                
                // Row number
                const rowLabel = document.createElement('div');
                rowLabel.className = 'row-number';
                rowLabel.textContent = rowNum;
                row.appendChild(rowLabel);
                
                // Left seats
                const leftGroup = document.createElement('div');
                leftGroup.className = 'seat-group';
                config.columns.slice(0, Math.floor(config.columns.length / 2)).forEach(col => {
                    const seat = this.createSeat(rowNum, col, classType, config, occupiedSeats, unlocked);
                    leftGroup.appendChild(seat);
                });
                row.appendChild(leftGroup);
                
                // Aisle
                const aisle = document.createElement('div');
                aisle.className = 'aisle';
                row.appendChild(aisle);
                
                // Right seats
                const rightGroup = document.createElement('div');
                rightGroup.className = 'seat-group';
                config.columns.slice(Math.floor(config.columns.length / 2)).forEach(col => {
                    const seat = this.createSeat(rowNum, col, classType, config, occupiedSeats, unlocked);
                    rightGroup.appendChild(seat);
                });
                row.appendChild(rightGroup);
                
                rows.appendChild(row);
            });
            
            section.appendChild(rows);
            seatMap.appendChild(section);
        });
    }
    
    generateOccupiedSeats() {
        // Generate a realistic distribution of occupied seats
        const occupied = new Set();
        const occupancyRate = 0.3; // 30% of seats occupied
        
        for (let row = 1; row <= 10; row++) {
            ['A', 'B', 'C', 'D', 'E', 'F'].forEach(col => {
                if (Math.random() < occupancyRate) {
                    occupied.add(`${row}${col}`);
                }
            });
        }
        
        return occupied;
    }
    
    createSeat(row, col, classType, config, occupiedSeats, unlocked) {
        const seatLabel = `${row}${col}`;
        const isOccupied = occupiedSeats.has(seatLabel);
        const isSelected = this.session.selectedSeatLabel === seatLabel;
        
        const seat = document.createElement('div');
        seat.className = `seat ${classType}`;
        seat.setAttribute('data-label', seatLabel);
        seat.setAttribute('data-class', classType);
        
        if (isOccupied) {
            seat.classList.add('occupied');
        } else if (unlocked) {
            seat.classList.add('available');
            if (isSelected) {
                seat.classList.add('selected');
            }
        } else {
            seat.classList.add('occupied');
        }
        
        // Add tooltip
        if (!isOccupied && unlocked) {
            const tooltip = document.createElement('div');
            tooltip.className = 'seat-tooltip';
            tooltip.innerHTML = `
                <strong>Seat ${seatLabel}</strong><br>
                ${config.perks.join(' • ')}
            `;
            seat.appendChild(tooltip);
        }
        
        // Add click handler
        if (!isOccupied && unlocked) {
            seat.addEventListener('click', () => {
                // Remove previous selection
                document.querySelectorAll('.seat.selected').forEach(s => s.classList.remove('selected'));
                
                // Select this seat
                seat.classList.add('selected');
                this.session.selectedSeat = classType;
                this.session.selectedSeatLabel = seatLabel;
                
                // Show selected seat info
                this.showSelectedSeatInfo(seatLabel, classType, config);
            });
        }
        
        return seat;
    }
    
    showSelectedSeatInfo(seatLabel, classType, config) {
        const infoDiv = document.getElementById('selectedSeatInfo');
        const detailsDiv = document.getElementById('seatDetails');
        const perksDiv = document.getElementById('seatPerks');
        
        const className = classType === 'first' ? 'First Class' : 
                         classType === 'business' ? 'Business Class' : 'Economy Class';
        
        detailsDiv.textContent = `Seat ${seatLabel} - ${className} (${config.multiplier}x miles)`;
        perksDiv.innerHTML = `✨ ${config.perks.join(' • ')}`;
        
        infoDiv.style.display = 'block';
        
        // Smooth scroll to show the info
        infoDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }

    renderRoutes() {
        const grid = document.getElementById('routesGrid');
        grid.innerHTML = '';
        
        const duration = this.session.selectedDuration;
        const recommendedRoutes = this.getRecommendedRoutes(duration);
        
        Object.entries(REAL_ROUTES).forEach(([id, route]) => {
            const fromUnlocked = this.data.unlockedCities.includes(route.fromCity);
            const toUnlocked = this.data.unlockedCities.includes(route.toCity);
            const unlocked = fromUnlocked && toUnlocked;
            const recommended = recommendedRoutes.includes(id);
            
            const card = document.createElement('div');
            card.className = `route-card${!unlocked ? ' locked' : ''}${recommended ? ' recommended' : ''}`;
            if (id === this.session.selectedRoute && unlocked) {
                card.classList.add('selected');
            }
            
            card.innerHTML = `
                <div class="route-cities">
                    ${route.from}<span class="route-arrow">→</span>${route.to}
                </div>
                <div class="route-info">
                    <div class="route-info-item">
                        <div class="route-info-label">Distance</div>
                        <div class="route-info-value">${route.distance} km</div>
                    </div>
                    <div class="route-info-item">
                        <div class="route-info-label">Flight Time</div>
                        <div class="route-info-value">${Math.floor(route.flightTime / 60)}h ${route.flightTime % 60}m</div>
                    </div>
                </div>
                ${!unlocked ? '<div class="locked-badge">🔒 Unlock cities to fly this route</div>' : ''}
            `;
            
            if (unlocked) {
                card.addEventListener('click', () => {
                    this.session.selectedRoute = id;
                    document.querySelectorAll('.route-card').forEach(c => c.classList.remove('selected'));
                    card.classList.add('selected');
                });
            }
            
            grid.appendChild(card);
        });
    }

    getRecommendedRoutes(duration) {
        // Suggest realistic routes based on focus duration
        const recommended = [];
        Object.entries(REAL_ROUTES).forEach(([id, route]) => {
            const ratio = duration / route.flightTime;
            // Recommend if duration is within 20-40% of actual flight time (realistic compression)
            if (ratio >= 0.15 && ratio <= 0.50) {
                recommended.push(id);
            }
        });
        return recommended;
    }

    goToStep(step) {
        // Hide all steps
        document.getElementById('step1Content').classList.add('hidden');
        document.getElementById('step2Content').classList.add('hidden');
        document.getElementById('step3Content').classList.add('hidden');
        
        // Update step indicators
        document.getElementById('step1Dot').classList.remove('active', 'completed');
        document.getElementById('step2Dot').classList.remove('active', 'completed');
        document.getElementById('step3Dot').classList.remove('active', 'completed');
        document.getElementById('connector1').classList.remove('completed');
        document.getElementById('connector2').classList.remove('completed');
        
        // Mark completed steps
        if (step > 1) {
            document.getElementById('step1Dot').classList.add('completed');
            document.getElementById('connector1').classList.add('completed');
        }
        if (step > 2) {
            document.getElementById('step2Dot').classList.add('completed');
            document.getElementById('connector2').classList.add('completed');
        }
        
        // Show current step
        document.getElementById(`step${step}Dot`).classList.add('active');
        document.getElementById(`step${step}Content`).classList.remove('hidden');
        
        // Special handling for step 3 (routes need rendering with current duration)
        if (step === 3) {
            this.renderRoutes();
        }
        
        this.session.currentStep = step;
    }

    getSeatMultiplier(seatClass) {
        const seat = this.seats.find(s => s.id === seatClass);
        return seat ? seat.multiplier : 1;
    }

    startFlight() {
        if (!this.session.selectedRoute) {
            alert('Please select a route first!');
            return;
        }

        const duration = this.session.selectedDuration;
        const seatClass = this.session.selectedSeat;
        const route = REAL_ROUTES[this.session.selectedRoute];

        this.session = {
            ...this.session,
            active: true,
            paused: false,
            duration: duration,
            elapsed: 0,
            seatClass: seatClass,
            route: this.session.selectedRoute,
            timer: null,
            startTime: Date.now()
        };

        // Hide booking, show tracker
        document.getElementById('bookingSteps').classList.add('hidden');
        document.getElementById('flightTracker').classList.remove('hidden');

        // Update flight info
        document.getElementById('flightRouteTitle').textContent = `${route.from} → ${route.to}`;
        document.getElementById('flightClass').textContent = seatClass.charAt(0).toUpperCase() + seatClass.slice(1);
        document.getElementById('flightDistance').textContent = `${route.distance} km`;
        
        const baseMiles = duration;
        const multiplier = this.getSeatMultiplier(seatClass);
        const totalMiles = Math.round(baseMiles * multiplier);
        document.getElementById('milesToEarn').textContent = totalMiles;

        // Update globe visualization
        this.updateGlobeVisualization(route);

        // Start the timer
        this.runTimer();
    }

    updateGlobeVisualization(route) {
        const [x1, y1] = route.departCoords;
        const [x2, y2] = route.arrivalCoords;
        
        // Update departure marker
        const departMarker = document.getElementById('departureMarker');
        departMarker.setAttribute('transform', `translate(${x1}, ${y1})`);
        document.getElementById('departureLabel').textContent = route.from;
        
        // Update arrival marker
        const arrivalMarker = document.getElementById('arrivalMarker');
        arrivalMarker.setAttribute('transform', `translate(${x2}, ${y2})`);
        document.getElementById('arrivalLabel').textContent = route.to;
        
        // Calculate curved path (arc over globe)
        const midX = (x1 + x2) / 2;
        const midY = Math.min(y1, y2) - Math.abs(x2 - x1) * 0.15; // Arc upward
        
        // Create bezier curve path
        const pathData = `M ${x1},${y1} Q ${midX},${midY} ${x2},${y2}`;
        document.getElementById('flightPath').setAttribute('d', pathData);
        
        // Position plane at start
        const plane = document.getElementById('plane');
        plane.setAttribute('x', x1);
        plane.setAttribute('y', y1);
    }

    runTimer() {
        const updateInterval = 100;
        
        this.session.timer = setInterval(() => {
            if (!this.session.paused) {
                this.session.elapsed += updateInterval / 1000;
                
                const remainingSeconds = Math.max(0, this.session.duration * 60 - this.session.elapsed);
                const minutes = Math.floor(remainingSeconds / 60);
                const seconds = Math.floor(remainingSeconds % 60);
                
                document.getElementById('timerDisplay').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                // Update progress
                const progress = (this.session.elapsed / (this.session.duration * 60)) * 100;
                const progressClamped = Math.min(progress, 100);
                document.getElementById('progressFill').style.width = `${progressClamped}%`;
                document.getElementById('progressPercentage').textContent = `${Math.round(progressClamped)}%`;
                
                // Animate plane along path
                this.animatePlane(progressClamped / 100);
                
                if (remainingSeconds <= 0) {
                    this.completeFlight();
                }
            }
        }, updateInterval);
    }

    animatePlane(progress) {
        const route = REAL_ROUTES[this.session.route];
        const [x1, y1] = route.departCoords;
        const [x2, y2] = route.arrivalCoords;
        
        // Calculate position along bezier curve
        const midX = (x1 + x2) / 2;
        const midY = Math.min(y1, y2) - Math.abs(x2 - x1) * 0.15;
        
        // Quadratic Bezier formula
        const t = progress;
        const planeX = (1-t)*(1-t)*x1 + 2*(1-t)*t*midX + t*t*x2;
        const planeY = (1-t)*(1-t)*y1 + 2*(1-t)*t*midY + t*t*y2;
        
        // Calculate angle for plane rotation
        const nextT = Math.min(t + 0.01, 1);
        const nextX = (1-nextT)*(1-nextT)*x1 + 2*(1-nextT)*nextT*midX + nextT*nextT*x2;
        const nextY = (1-nextT)*(1-nextT)*y1 + 2*(1-nextT)*nextT*midY + nextT*nextT*y2;
        const angle = Math.atan2(nextY - planeY, nextX - planeX) * 180 / Math.PI;
        
        const plane = document.getElementById('plane');
        plane.setAttribute('x', planeX);
        plane.setAttribute('y', planeY);
        plane.setAttribute('transform', `rotate(${angle} ${planeX} ${planeY})`);
    }

    togglePause() {
        this.session.paused = !this.session.paused;
        const btn = document.getElementById('pauseFlight');
        btn.textContent = this.session.paused ? '▶️ Resume' : '⏸️ Pause';
    }

    cancelFlight() {
        if (confirm('Are you sure you want to cancel this flight? You will not earn any miles.')) {
            this.endFlight(false);
        }
    }

    completeFlight() {
        this.endFlight(true);
    }

    endFlight(completed) {
        clearInterval(this.session.timer);
        
        if (completed) {
            const baseMiles = this.session.duration;
            const multiplier = this.getSeatMultiplier(this.session.seatClass);
            const earnedMiles = Math.round(baseMiles * multiplier);
            
            this.data.totalMiles += earnedMiles;
            this.data.flightsCompleted += 1;
            
            this.saveData();
            this.updateUI();
            this.checkAchievements();
            this.checkUnlocks();
            this.renderAchievements();
            this.renderCities();
            
            alert(`🎉 Flight Completed!\n\nYou earned ${earnedMiles} miles!\nTotal Miles: ${this.data.totalMiles}`);
        }
        
        // Reset to booking
        document.getElementById('bookingSteps').classList.remove('hidden');
        document.getElementById('flightTracker').classList.add('hidden');
        this.goToStep(1);
        
        // Reset selections
        this.session.selectedRoute = null;
        this.session.active = false;
    }

    checkAchievements() {
        this.achievements.forEach(achievement => {
            if (!this.data.achievements.includes(achievement.id)) {
                const value = achievement.type === 'flights' ? this.data.flightsCompleted : this.data.totalMiles;
                if (value >= achievement.requirement) {
                    this.data.achievements.push(achievement.id);
                    this.showAchievementNotification(achievement);
                }
            }
        });
    }

    showAchievementNotification(achievement) {
        setTimeout(() => {
            alert(`🏆 Achievement Unlocked!\n\n${achievement.icon} ${achievement.name}\n${achievement.desc}`);
        }, 500);
    }

    checkUnlocks() {
        // Check seat unlocks
        if (this.data.totalMiles >= 500 && !this.data.unlockedSeats.includes('first')) {
            this.data.unlockedSeats.push('first');
        }
        
        // Check city unlocks
        this.cities.forEach(city => {
            if (this.data.totalMiles >= city.requirement && !this.data.unlockedCities.includes(city.id)) {
                this.data.unlockedCities.push(city.id);
            }
        });
    }

    renderAchievements() {
        const grid = document.getElementById('achievementsGrid');
        grid.innerHTML = '';
        
        this.achievements.forEach(achievement => {
            const unlocked = this.data.achievements.includes(achievement.id);
            const card = document.createElement('div');
            card.className = `achievement-card ${unlocked ? 'unlocked' : 'locked'}`;
            
            const value = achievement.type === 'flights' ? this.data.flightsCompleted : this.data.totalMiles;
            const progress = unlocked ? '' : `<div class="achievement-desc">${value}/${achievement.requirement}</div>`;
            
            card.innerHTML = `
                <div class="achievement-icon">${achievement.icon}</div>
                <div class="achievement-name">${achievement.name}</div>
                <div class="achievement-desc">${achievement.desc}</div>
                ${progress}
            `;
            
            grid.appendChild(card);
        });
    }

    renderCities() {
        const grid = document.getElementById('citiesGrid');
        grid.innerHTML = '';
        
        this.cities.forEach(city => {
            const unlocked = this.data.unlockedCities.includes(city.id);
            const card = document.createElement('div');
            card.className = `city-card ${unlocked ? 'unlocked' : 'locked'}`;
            
            card.innerHTML = `
                <div class="city-icon">${city.icon}</div>
                <div class="city-name">${city.name}</div>
                ${!unlocked ? `<div class="city-requirement">🔒 ${city.requirement} miles</div>` : ''}
            `;
            
            grid.appendChild(card);
        });
    }
}

// Initialize the app
document.addEventListener('DOMContentLoaded', () => {
    new FocusFlight();
});
    </script>
</body>
</html>
