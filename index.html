<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FocusFlight - Your Realistic Focus Journey</title>
    <style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #7e8ba3 100%);
    min-height: 100vh;
    padding: 20px;
    color: #333;
}

.container {
    max-width: 1400px;
    margin: 0 auto;
}

/* Header Styles */
.header {
    background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
    padding: 20px 40px;
    border-radius: 16px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;
    border: 1px solid rgba(255, 255, 255, 0.3);
}

.header h1 {
    font-size: 2.2em;
    background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    font-weight: 700;
}

.stats {
    display: flex;
    gap: 40px;
}

.stat-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 10px 20px;
    background: rgba(30, 60, 114, 0.05);
    border-radius: 12px;
}

.stat-label {
    font-size: 0.85em;
    color: #666;
    text-transform: uppercase;
    letter-spacing: 1px;
    font-weight: 600;
}

.stat-value {
    font-size: 1.8em;
    font-weight: 700;
    background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-top: 5px;
}

/* Main Content */
.main-content {
    display: grid;
    gap: 24px;
}

/* Booking Steps Container */
.booking-steps {
    background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
    padding: 40px;
    border-radius: 16px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.3);
    min-height: 600px;
    position: relative;
    overflow: hidden;
}

.booking-steps::before {
    content: '';
    position: absolute;
    top: -50%;
    right: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(30, 60, 114, 0.03) 0%, transparent 70%);
    pointer-events: none;
}

.step-indicator {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
    margin-bottom: 40px;
    padding-bottom: 30px;
    border-bottom: 2px solid #e9ecef;
}

.step-dot {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: #e9ecef;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 1.1em;
    color: #999;
    position: relative;
    transition: all 0.4s ease;
}

.step-dot.active {
    background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
    color: white;
    transform: scale(1.15);
    box-shadow: 0 4px 20px rgba(30, 60, 114, 0.4);
}

.step-dot.completed {
    background: #28a745;
    color: white;
}

.step-connector {
    width: 80px;
    height: 3px;
    background: #e9ecef;
    transition: all 0.4s ease;
}

.step-connector.completed {
    background: #28a745;
}

.step-content {
    opacity: 0;
    transform: translateY(30px);
    transition: opacity 0.5s ease, transform 0.5s ease;
}

.step-content:not(.hidden) {
    opacity: 1;
    transform: translateY(0);
}

.step-title {
    font-size: 2em;
    color: #1e3c72;
    margin-bottom: 10px;
    text-align: center;
    font-weight: 700;
}

.step-subtitle {
    font-size: 1.1em;
    color: #666;
    text-align: center;
    margin-bottom: 30px;
    font-weight: 500;
}

/* Duration Selection */
.duration-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.duration-card {
    background: white;
    border: 3px solid #e9ecef;
    border-radius: 16px;
    padding: 30px 25px;
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: center;
    position: relative;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}

.duration-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
    border-color: #2a5298;
}

.duration-card.selected {
    border-color: #2a5298;
    background: linear-gradient(135deg, rgba(30, 60, 114, 0.08) 0%, rgba(42, 82, 152, 0.08) 100%);
    box-shadow: 0 8px 20px rgba(30, 60, 114, 0.3);
    transform: scale(1.05);
}

.duration-card.selected::after {
    content: '‚úì';
    position: absolute;
    top: 10px;
    right: 10px;
    background: #28a745;
    color: white;
    width: 28px;
    height: 28px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 1.1em;
}

.duration-time {
    font-size: 2.5em;
    font-weight: 700;
    color: #1e3c72;
    margin-bottom: 10px;
}

.duration-label {
    font-size: 1.1em;
    color: #666;
    font-weight: 600;
}

/* Seat Selection - Airplane Interior */
.airplane-container {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-radius: 20px;
    padding: 40px 20px;
    margin-bottom: 30px;
    box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.1);
    max-width: 900px;
    margin-left: auto;
    margin-right: auto;
}

.airplane-interior {
    background: white;
    border-radius: 30px 30px 16px 16px;
    padding: 30px 20px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
    position: relative;
    overflow: hidden;
}

.airplane-interior::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 20px;
    background: linear-gradient(90deg, #1e3c72 0%, #2a5298 50%, #1e3c72 100%);
    border-radius: 30px 30px 0 0;
}

.airplane-nose {
    text-align: center;
    font-size: 2em;
    margin-bottom: 20px;
    padding-top: 10px;
}

.seat-class-section {
    margin-bottom: 30px;
    padding: 20px 15px;
    border-radius: 12px;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.5) 0%, rgba(248, 249, 250, 0.5) 100%);
    position: relative;
}

.seat-class-section.locked {
    opacity: 0.6;
    pointer-events: none;
}

.seat-class-section.locked::after {
    content: 'üîí LOCKED';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(220, 53, 69, 0.95);
    color: white;
    padding: 15px 30px;
    border-radius: 12px;
    font-weight: 700;
    font-size: 1.2em;
    letter-spacing: 2px;
    z-index: 10;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
}

.class-header {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 15px;
    margin-bottom: 20px;
    padding: 15px;
    background: linear-gradient(135deg, rgba(30, 60, 114, 0.1) 0%, rgba(42, 82, 152, 0.1) 100%);
    border-radius: 10px;
}

.class-header.first {
    background: linear-gradient(135deg, rgba(255, 215, 0, 0.2) 0%, rgba(255, 193, 7, 0.2) 100%);
}

.class-header.business {
    background: linear-gradient(135deg, rgba(42, 82, 152, 0.15) 0%, rgba(30, 60, 114, 0.15) 100%);
}

.class-header.economy {
    background: linear-gradient(135deg, rgba(108, 117, 125, 0.1) 0%, rgba(73, 80, 87, 0.1) 100%);
}

.class-title {
    font-size: 1.5em;
    font-weight: 700;
    color: #1e3c72;
}

.class-multiplier {
    background: #28a745;
    color: white;
    padding: 5px 15px;
    border-radius: 20px;
    font-size: 0.9em;
    font-weight: 600;
}

.seat-rows {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.seat-row {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 5px 0;
}

.row-number {
    width: 30px;
    text-align: center;
    font-weight: 700;
    color: #666;
    font-size: 0.9em;
}

.seat-group {
    display: flex;
    gap: 8px;
}

.aisle {
    width: 40px;
    min-width: 40px;
}

.seat {
    width: 45px;
    height: 45px;
    border-radius: 8px 8px 4px 4px;
    border: 2px solid #dee2e6;
    background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.75em;
    font-weight: 600;
    color: #666;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

.seat.first {
    width: 55px;
    height: 55px;
    font-size: 0.85em;
    background: linear-gradient(135deg, #fff8e1 0%, #ffeaa7 100%);
    border-color: #ffc107;
}

.seat.business {
    width: 50px;
    height: 50px;
    font-size: 0.8em;
    background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
    border-color: #2196f3;
}

.seat.economy {
    background: linear-gradient(135deg, #ffffff 0%, #f1f3f5 100%);
    border-color: #ced4da;
}

.seat.available:hover {
    transform: translateY(-3px) scale(1.08);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    border-color: #2a5298;
}

.seat.selected {
    background: linear-gradient(135deg, #2a5298 0%, #1e3c72 100%);
    border-color: #1e3c72;
    color: white;
    transform: scale(1.1);
    box-shadow: 0 5px 20px rgba(30, 60, 114, 0.4);
    animation: seatPulse 1.5s ease-in-out infinite;
}

@keyframes seatPulse {
    0%, 100% {
        box-shadow: 0 5px 20px rgba(30, 60, 114, 0.4);
    }
    50% {
        box-shadow: 0 5px 30px rgba(30, 60, 114, 0.6);
    }
}

.seat.occupied {
    background: linear-gradient(135deg, #e9ecef 0%, #ced4da 100%);
    border-color: #adb5bd;
    cursor: not-allowed;
    color: #adb5bd;
}

.seat.occupied::after {
    content: '‚úï';
    position: absolute;
    font-size: 1.2em;
    color: #6c757d;
}

.seat::before {
    content: attr(data-label);
    position: absolute;
    font-size: 0.7em;
    font-weight: 600;
    opacity: 0.8;
}

.seat-tooltip {
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%) translateY(-10px);
    background: rgba(0, 0, 0, 0.9);
    color: white;
    padding: 10px 15px;
    border-radius: 8px;
    font-size: 0.85em;
    white-space: nowrap;
    pointer-events: none;
    opacity: 0;
    transition: all 0.3s ease;
    z-index: 100;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
}

.seat-tooltip::after {
    content: '';
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
    border: 6px solid transparent;
    border-top-color: rgba(0, 0, 0, 0.9);
}

.seat:hover .seat-tooltip {
    opacity: 1;
    transform: translateX(-50%) translateY(-5px);
}

.seat-legend {
    display: flex;
    justify-content: center;
    gap: 30px;
    margin-top: 30px;
    padding: 20px;
    background: rgba(248, 249, 250, 0.5);
    border-radius: 12px;
}

.legend-item {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 0.9em;
}

.legend-seat {
    width: 35px;
    height: 35px;
    border-radius: 6px 6px 3px 3px;
    border: 2px solid;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.7em;
}

.legend-seat.available {
    background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
    border-color: #dee2e6;
}

.legend-seat.selected {
    background: linear-gradient(135deg, #2a5298 0%, #1e3c72 100%);
    border-color: #1e3c72;
    color: white;
}

.legend-seat.occupied {
    background: linear-gradient(135deg, #e9ecef 0%, #ced4da 100%);
    border-color: #adb5bd;
    color: #adb5bd;
}

.selected-seat-info {
    text-align: center;
    padding: 20px;
    margin-top: 20px;
    background: linear-gradient(135deg, rgba(30, 60, 114, 0.1) 0%, rgba(42, 82, 152, 0.1) 100%);
    border-radius: 12px;
    border: 2px solid #2a5298;
}

.selected-seat-info h3 {
    color: #1e3c72;
    font-size: 1.3em;
    margin-bottom: 10px;
}

.selected-seat-info p {
    color: #495057;
    font-size: 1.1em;
    font-weight: 600;
}

.selected-seat-info .seat-perks {
    margin-top: 10px;
    font-size: 0.95em;
    color: #28a745;
}

/* Route Selection */
.routes-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
    max-height: 500px;
    overflow-y: auto;
    padding: 10px;
}

.route-card {
    background: white;
    border: 3px solid #e9ecef;
    border-radius: 16px;
    padding: 25px;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}

.route-card:hover:not(.locked) {
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
    border-color: #2a5298;
}

.route-card.selected {
    border-color: #2a5298;
    background: linear-gradient(135deg, rgba(30, 60, 114, 0.08) 0%, rgba(42, 82, 152, 0.08) 100%);
    box-shadow: 0 8px 20px rgba(30, 60, 114, 0.3);
    transform: translateY(-3px);
}

.route-card.locked {
    opacity: 0.5;
    cursor: not-allowed;
    filter: grayscale(0.5);
}

.route-card.recommended {
    border-color: #ffc107;
    background: linear-gradient(135deg, rgba(255, 193, 7, 0.15) 0%, rgba(255, 193, 7, 0.05) 100%);
    box-shadow: 0 4px 15px rgba(255, 193, 7, 0.2);
}

.route-card.recommended::before {
    content: "‚≠ê RECOMMENDED";
    position: absolute;
    top: -10px;
    right: 15px;
    background: #ffc107;
    color: #333;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.75em;
    font-weight: 700;
    letter-spacing: 1px;
}

.locked-badge {
    position: absolute;
    bottom: 10px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(220, 53, 69, 0.9);
    color: white;
    padding: 8px 16px;
    border-radius: 8px;
    font-size: 0.85em;
    font-weight: 600;
    text-align: center;
    width: calc(100% - 40px);
}

.route-cities {
    font-size: 1.5em;
    font-weight: 700;
    color: #1e3c72;
    margin-bottom: 15px;
    text-align: center;
}

.route-arrow {
    color: #2a5298;
    margin: 0 10px;
}

.route-info {
    display: flex;
    justify-content: space-around;
    gap: 15px;
    margin-top: 15px;
    padding-top: 15px;
    border-top: 2px solid #e9ecef;
}

.route-info-item {
    text-align: center;
}

.route-info-label {
    font-size: 0.8em;
    color: #999;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 5px;
}

.route-info-value {
    font-size: 1.1em;
    color: #333;
    font-weight: 700;
}

/* Buttons */
.btn {
    padding: 18px 40px;
    border: none;
    border-radius: 12px;
    font-size: 1.2em;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 1px;
    display: inline-block;
}

.btn-primary {
    background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
    color: white;
    box-shadow: 0 6px 20px rgba(30, 60, 114, 0.3);
}

.btn-primary:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 30px rgba(30, 60, 114, 0.4);
}

.btn-secondary {
    background: #6c757d;
    color: white;
}

.btn-secondary:hover {
    background: #5a6268;
    transform: translateY(-2px);
}

.btn-danger {
    background: #dc3545;
    color: white;
}

.btn-danger:hover {
    background: #c82333;
}

.btn-group {
    display: flex;
    gap: 20px;
    justify-content: center;
    margin-top: 30px;
}

/* Flight Tracker Section */
.flight-tracker {
    background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
    padding: 40px;
    border-radius: 16px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.3);
}

.flight-tracker.hidden {
    display: none;
}

.flight-header {
    text-align: center;
    margin-bottom: 30px;
}

.flight-route-title {
    font-size: 2.5em;
    color: #1e3c72;
    font-weight: 700;
    margin-bottom: 10px;
}

.flight-details {
    display: flex;
    justify-content: center;
    gap: 40px;
    font-size: 1.1em;
    color: #666;
}

/* Globe Visualization */
.globe-container {
    background: linear-gradient(135deg, #0a1929 0%, #1a2332 50%, #2a3f5f 100%);
    border-radius: 16px;
    padding: 30px;
    margin-bottom: 30px;
    position: relative;
    overflow: hidden;
}

.globe-container::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: 
        radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 70% 70%, rgba(255, 255, 255, 0.05) 0%, transparent 50%);
    pointer-events: none;
}

#globeMap {
    width: 100%;
    height: auto;
    filter: drop-shadow(0 10px 30px rgba(0, 0, 0, 0.3));
}

#mapContent {
    transition: transform 1.5s cubic-bezier(0.4, 0, 0.2, 1);
    transform-origin: center center;
}

/* Timer */
.timer-section {
    margin-bottom: 30px;
}

.timer-display {
    font-size: 5em;
    font-weight: 700;
    text-align: center;
    background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 20px;
    font-variant-numeric: tabular-nums;
}

.progress-container {
    width: 100%;
    height: 40px;
    background: #e9ecef;
    border-radius: 20px;
    overflow: hidden;
    position: relative;
    box-shadow: inset 0 2px 6px rgba(0, 0, 0, 0.1);
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #28a745 0%, #20c997 100%);
    width: 0%;
    transition: width 0.3s ease;
    border-radius: 20px;
    position: relative;
    overflow: hidden;
}

.progress-fill::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(
        90deg,
        transparent,
        rgba(255, 255, 255, 0.3),
        transparent
    );
    animation: shimmer 2s infinite;
}

@keyframes shimmer {
    0% {
        transform: translateX(-100%);
    }
    100% {
        transform: translateX(100%);
    }
}

.progress-percentage {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-weight: 700;
    color: #333;
    font-size: 1.1em;
}

/* Controls */
.controls {
    display: flex;
    gap: 20px;
    justify-content: center;
}

/* Lower sections */
.info-sections {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 24px;
}

.info-section {
    background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
    padding: 30px;
    border-radius: 16px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.3);
}

.info-section h2 {
    color: #1e3c72;
    margin-bottom: 20px;
    font-size: 1.8em;
    font-weight: 700;
}

.achievements-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 15px;
}

.achievement-card {
    background: white;
    border: 2px solid #e9ecef;
    border-radius: 12px;
    padding: 20px;
    text-align: center;
    transition: all 0.3s ease;
}

.achievement-card.unlocked {
    background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
    border-color: #ffc107;
}

.achievement-card.locked {
    opacity: 0.4;
}

.achievement-icon {
    font-size: 2.5em;
    margin-bottom: 10px;
}

.achievement-name {
    font-weight: 700;
    margin-bottom: 5px;
    color: #1e3c72;
}

.achievement-desc {
    font-size: 0.85em;
    color: #666;
}

.cities-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
    gap: 15px;
}

.city-card {
    background: white;
    border: 2px solid #e9ecef;
    border-radius: 12px;
    padding: 15px;
    text-align: center;
    transition: all 0.3s ease;
}

.city-card.unlocked {
    background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%);
    border-color: #17a2b8;
}

.city-card.locked {
    opacity: 0.4;
}

.city-icon {
    font-size: 2em;
    margin-bottom: 8px;
}

.city-name {
    font-weight: 700;
    color: #1e3c72;
    margin-bottom: 5px;
}

.city-requirement {
    font-size: 0.8em;
    color: #666;
}

/* Responsive Design */
@media (max-width: 1024px) {
    .info-sections {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 768px) {
    .header {
        flex-direction: column;
        gap: 20px;
    }

    .stats {
        flex-direction: row;
        flex-wrap: wrap;
        gap: 15px;
        justify-content: center;
    }

    .duration-grid,
    .seat-grid,
    .routes-grid {
        grid-template-columns: 1fr;
    }

    .timer-display {
        font-size: 3.5em;
    }

    .controls {
        flex-direction: column;
    }

    .btn {
        width: 100%;
    }

    .step-indicator {
        overflow-x: auto;
        justify-content: flex-start;
        padding-bottom: 20px;
    }
}

/* Animations */
@keyframes slideInRight {
    from {
        opacity: 0;
        transform: translateX(50px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

@keyframes slideInLeft {
    from {
        opacity: 0;
        transform: translateX(-50px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

.slide-in-right {
    animation: slideInRight 0.6s ease forwards;
}

.slide-in-left {
    animation: slideInLeft 0.6s ease forwards;
}

@keyframes pulse {
    0%, 100% {
        transform: scale(1);
    }
    50% {
        transform: scale(1.05);
    }
}

.pulse {
    animation: pulse 2s infinite;
}

/* Hidden utility */
.hidden {
    display: none !important;
}
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>‚úàÔ∏è FocusFlight</h1>
            <div class="stats">
                <div class="stat-item">
                    <span class="stat-label">Total Miles</span>
                    <span class="stat-value" id="totalMiles">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Flights</span>
                    <span class="stat-value" id="flightsCompleted">0</span>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Booking Steps -->
            <section class="booking-steps" id="bookingSteps">
                <!-- Step Indicator -->
                <div class="step-indicator">
                    <div class="step-dot active" id="step1Dot">1</div>
                    <div class="step-connector" id="connector1"></div>
                    <div class="step-dot" id="step2Dot">2</div>
                    <div class="step-connector" id="connector2"></div>
                    <div class="step-dot" id="step3Dot">3</div>
                </div>

                <!-- Step 1: Time Selection -->
                <div class="step-content" id="step1Content">
                    <h2 class="step-title">Select Your Focus Time</h2>
                    <p class="step-subtitle">How long would you like to focus?</p>
                    <div class="duration-grid" id="durationGrid"></div>
                    <div class="btn-group">
                        <button class="btn btn-primary" id="continueToFlights">Continue to Flight Selection</button>
                    </div>
                </div>

                <!-- Step 2: Flight Selection -->
                <div class="step-content hidden" id="step2Content">
                    <h2 class="step-title">Select Your Flight</h2>
                    <p class="step-subtitle" id="flightFilterMessage">Showing flights suitable for your selected time</p>
                    <div class="routes-grid" id="routesGrid"></div>
                    <div class="btn-group">
                        <button class="btn btn-secondary" id="backToDuration">Back</button>
                        <button class="btn btn-primary" id="continueToSeats">Continue to Seat Selection</button>
                    </div>
                </div>

                <!-- Step 3: Seat Selection -->
                <div class="step-content hidden" id="step3Content">
                    <h2 class="step-title">Select Your Seat</h2>
                    <p class="step-subtitle">Choose your preferred cabin class and seat</p>
                    <div class="airplane-container">
                        <div class="airplane-interior">
                            <div class="airplane-nose">‚úàÔ∏è</div>
                            <div id="seatMap"></div>
                            <div class="seat-legend">
                                <div class="legend-item">
                                    <div class="legend-seat available"></div>
                                    <span>Available</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-seat selected"></div>
                                    <span>Selected</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-seat occupied">‚úï</div>
                                    <span>Occupied</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="selectedSeatInfo" class="selected-seat-info" style="display: none;">
                        <h3>Selected Seat</h3>
                        <p id="seatDetails"></p>
                        <div class="seat-perks" id="seatPerks"></div>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-secondary" id="backToFlights">Back</button>
                        <button class="btn btn-primary" id="startFlight">Start Your Flight ‚úàÔ∏è</button>
                    </div>
                </div>
            </section>

            <!-- Flight Tracker -->
            <section class="flight-tracker hidden" id="flightTracker">
                <div class="flight-header">
                    <h2 class="flight-route-title" id="flightRouteTitle">New York ‚Üí Boston</h2>
                    <div class="flight-details">
                        <span><strong>Class:</strong> <span id="flightClass">Economy</span></span>
                        <span><strong>Distance:</strong> <span id="flightDistance">306 km</span></span>
                        <span><strong>Miles to Earn:</strong> <span id="milesToEarn">25</span></span>
                    </div>
                </div>

                <!-- Globe Visualization -->
                <div class="globe-container">
                    <svg id="globeMap" viewBox="0 0 800 500">
                        <!-- Globe background -->
                        <defs>
                            <radialGradient id="globeGradient" cx="50%" cy="50%">
                                <stop offset="0%" style="stop-color:#4a90e2;stop-opacity:1" />
                                <stop offset="70%" style="stop-color:#2c5aa0;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#1a3a6e;stop-opacity:1" />
                            </radialGradient>
                            <radialGradient id="globeHighlight" cx="35%" cy="35%">
                                <stop offset="0%" style="stop-color:#ffffff;stop-opacity:0.3" />
                                <stop offset="50%" style="stop-color:#ffffff;stop-opacity:0" />
                            </radialGradient>
                            <clipPath id="globeClip">
                                <circle cx="400" cy="250" r="220"/>
                            </clipPath>
                        </defs>
                        
                        <!-- Background circle -->
                        <circle cx="400" cy="250" r="220" fill="url(#globeGradient)" />
                        
                        <!-- Zoomable/Pannable map content group -->
                        <g id="mapContent" clip-path="url(#globeClip)">
                            <!-- Latitude lines -->
                            <g id="gridLines" opacity="0.15">
                                <ellipse cx="400" cy="250" rx="220" ry="220" fill="none" stroke="rgba(255,255,255,1)" stroke-width="1"/>
                                <ellipse cx="400" cy="250" rx="220" ry="110" fill="none" stroke="rgba(255,255,255,1)" stroke-width="1"/>
                                <ellipse cx="400" cy="250" rx="220" ry="44" fill="none" stroke="rgba(255,255,255,1)" stroke-width="1"/>
                                <line x1="180" y1="250" x2="620" y2="250" stroke="rgba(255,255,255,1)" stroke-width="2"/>
                                <!-- Longitude lines -->
                                <ellipse cx="400" cy="250" rx="110" ry="220" fill="none" stroke="rgba(255,255,255,1)" stroke-width="1"/>
                                <ellipse cx="400" cy="250" rx="44" ry="220" fill="none" stroke="rgba(255,255,255,1)" stroke-width="1"/>
                                <line x1="400" y1="30" x2="400" y2="470" stroke="rgba(255,255,255,1)" stroke-width="2"/>
                            </g>
                            
                            <!-- Detailed Continental outlines -->
                            <g id="continents" fill="#3d7e3d" opacity="0.75" stroke="#2d6e2d" stroke-width="0.5">
                                <!-- North America - More detailed -->
                                <path d="M 170,140 L 175,135 L 180,125 L 190,115 L 200,110 L 210,108 L 220,107 L 230,108 L 240,112 L 250,115 L 260,118 L 270,125 L 275,130 L 280,138 L 285,145 L 290,150 L 295,155 L 300,162 L 305,168 L 310,173 L 315,178 L 320,185 L 323,192 L 325,200 L 326,208 L 325,216 L 323,224 L 320,232 L 316,240 L 312,245 L 307,250 L 302,255 L 297,258 L 292,260 L 287,262 L 282,263 L 277,264 L 272,265 L 267,266 L 262,268 L 257,272 L 252,276 L 247,278 L 242,279 L 237,279 L 232,278 L 227,276 L 222,273 L 217,269 L 212,265 L 207,260 L 202,254 L 197,248 L 193,242 L 189,235 L 186,228 L 183,221 L 181,214 L 179,207 L 178,200 L 177,193 L 177,186 L 178,179 L 179,172 L 180,165 L 180,158 L 178,151 L 175,145 L 172,142 Z
                                     M 200,108 L 205,103 L 212,100 L 220,99 L 228,100 L 235,103 L 242,108 L 248,115 L 252,122 L 255,130 L 256,138 L 256,146 L 254,154 L 251,161 L 248,167 L 244,172 L 240,176 L 235,179 L 230,181 L 225,182 L 220,182 L 215,181 L 210,179 L 206,176 L 203,172 L 201,167 L 200,161 L 200,155 L 201,149 L 203,143 L 205,137 L 207,131 L 208,125 L 207,119 L 205,113 Z"/>
                                
                                <!-- Mexico and Central America -->
                                <path d="M 240,220 L 245,218 L 250,217 L 255,218 L 260,220 L 265,223 L 270,227 L 273,232 L 275,237 L 276,242 L 276,247 L 275,252 L 273,257 L 270,261 L 267,264 L 263,266 L 259,267 L 255,267 L 251,266 L 247,264 L 244,261 L 242,257 L 240,253 L 239,248 L 239,243 L 240,238 L 241,233 L 242,228 Z"/>
                                
                                <!-- South America - More detailed -->
                                <path d="M 285,280 L 290,278 L 295,278 L 300,280 L 305,284 L 309,289 L 312,295 L 314,302 L 315,309 L 316,316 L 316,323 L 316,330 L 315,337 L 314,344 L 312,351 L 310,358 L 307,365 L 304,372 L 300,378 L 296,384 L 292,389 L 287,394 L 282,398 L 277,401 L 272,403 L 267,404 L 262,404 L 257,403 L 252,400 L 248,397 L 244,393 L 241,388 L 238,383 L 236,377 L 235,371 L 234,365 L 234,359 L 235,353 L 236,347 L 238,341 L 240,335 L 243,329 L 246,324 L 249,319 L 253,314 L 257,310 L 261,306 L 265,303 L 269,300 L 273,298 L 277,296 L 281,290 Z"/>
                                
                                <!-- Europe - Detailed -->
                                <path d="M 410,125 L 415,123 L 420,122 L 425,122 L 430,123 L 435,125 L 440,128 L 444,132 L 447,137 L 450,142 L 452,148 L 453,154 L 454,160 L 454,166 L 453,172 L 451,178 L 449,183 L 446,188 L 442,192 L 438,195 L 433,197 L 428,198 L 423,198 L 418,197 L 413,195 L 409,192 L 405,188 L 402,183 L 400,178 L 399,172 L 398,166 L 398,160 L 399,154 L 400,148 L 402,143 L 404,138 L 406,133 L 408,128 Z
                                     M 425,120 L 430,118 L 435,117 L 440,118 L 445,120 L 449,123 L 452,127 L 454,132 L 455,137 L 455,142 L 454,147 L 452,152 L 449,156 L 446,159 L 442,161 L 438,162 L 433,162 L 429,161 L 425,159 L 422,156 L 420,152 L 419,147 L 419,142 L 420,137 L 421,132 L 423,127 L 424,123 Z"/>
                                
                                <!-- Scandinavia -->
                                <path d="M 440,100 L 443,95 L 446,92 L 450,90 L 454,90 L 458,91 L 462,94 L 465,98 L 467,103 L 468,108 L 468,113 L 467,118 L 465,122 L 462,126 L 458,128 L 454,129 L 450,128 L 446,126 L 443,123 L 441,119 L 440,114 L 440,109 L 440,104 Z"/>
                                
                                <!-- Africa - Detailed -->
                                <path d="M 430,210 L 435,208 L 440,207 L 445,208 L 450,210 L 454,213 L 458,217 L 461,222 L 464,228 L 466,234 L 468,240 L 469,247 L 470,254 L 470,261 L 470,268 L 469,275 L 468,282 L 466,289 L 464,296 L 461,303 L 458,310 L 454,316 L 450,322 L 445,327 L 440,332 L 435,336 L 430,339 L 425,341 L 420,342 L 415,342 L 410,341 L 405,339 L 400,336 L 396,332 L 392,327 L 389,322 L 386,316 L 384,310 L 382,303 L 381,296 L 380,289 L 380,282 L 381,275 L 382,268 L 384,261 L 386,254 L 389,247 L 392,241 L 396,235 L 400,230 L 405,225 L 410,221 L 415,218 L 420,215 L 425,213 Z"/>
                                
                                <!-- Madagascar -->
                                <path d="M 485,320 L 487,318 L 490,317 L 493,318 L 495,320 L 497,323 L 498,327 L 498,331 L 497,335 L 495,338 L 493,340 L 490,341 L 487,341 L 485,340 L 483,338 L 482,335 L 481,331 L 481,327 L 482,323 Z"/>
                                
                                <!-- Middle East -->
                                <path d="M 460,175 L 465,173 L 470,173 L 475,175 L 479,178 L 482,182 L 484,187 L 485,192 L 485,197 L 484,202 L 482,206 L 479,209 L 475,211 L 470,212 L 465,212 L 461,211 L 458,209 L 456,206 L 455,202 L 455,197 L 456,192 L 458,187 L 460,182 Z"/>
                                
                                <!-- India -->
                                <path d="M 510,220 L 515,218 L 520,218 L 524,220 L 527,223 L 529,227 L 530,232 L 530,237 L 529,242 L 527,247 L 524,251 L 520,254 L 515,256 L 510,256 L 506,254 L 503,251 L 501,247 L 500,242 L 500,237 L 501,232 L 503,227 L 506,223 Z"/>
                                
                                <!-- Southeast Asia -->
                                <path d="M 540,235 L 543,233 L 547,233 L 550,235 L 552,238 L 553,242 L 553,246 L 552,250 L 550,253 L 547,255 L 543,256 L 540,256 L 537,255 L 535,253 L 534,250 L 534,246 L 534,242 L 535,238 L 537,236 Z
                                     M 555,250 L 557,248 L 560,248 L 562,250 L 563,253 L 563,256 L 562,259 L 560,261 L 557,261 L 555,260 L 554,258 L 554,255 L 554,252 Z
                                     M 548,260 L 550,258 L 553,258 L 555,260 L 556,263 L 556,266 L 555,269 L 553,271 L 550,271 L 548,270 L 547,268 L 547,265 L 547,262 Z"/>
                                
                                <!-- Australia -->
                                <path d="M 580,310 L 590,308 L 600,308 L 608,310 L 615,314 L 620,319 L 624,325 L 626,332 L 627,339 L 626,346 L 624,353 L 620,359 L 615,364 L 608,368 L 600,370 L 590,370 L 582,368 L 575,364 L 570,359 L 566,353 L 563,346 L 562,339 L 563,332 L 566,325 L 570,319 L 575,314 Z"/>
                                
                                <!-- New Zealand -->
                                <path d="M 625,385 L 628,383 L 632,383 L 635,385 L 637,388 L 638,392 L 638,396 L 637,400 L 635,403 L 632,405 L 628,405 L 625,404 L 623,402 L 622,399 L 622,395 L 622,391 L 623,387 Z
                                     M 628,410 L 630,408 L 633,408 L 635,410 L 636,413 L 636,416 L 635,419 L 633,421 L 630,421 L 628,420 L 627,418 L 627,415 L 627,412 Z"/>
                                
                                <!-- Japan -->
                                <path d="M 605,175 L 608,173 L 612,173 L 615,175 L 617,178 L 618,182 L 618,186 L 617,190 L 615,193 L 612,195 L 608,195 L 605,194 L 603,192 L 602,189 L 602,185 L 602,181 L 603,177 Z
                                     M 610,158 L 612,156 L 615,156 L 617,158 L 618,161 L 618,164 L 617,167 L 615,169 L 612,169 L 610,168 L 609,166 L 609,163 L 609,160 Z"/>
                                
                                <!-- Philippines -->
                                <path d="M 565,240 L 567,238 L 570,238 L 572,240 L 573,243 L 573,246 L 572,249 L 570,251 L 567,251 L 565,250 L 564,248 L 564,245 L 564,242 Z
                                     M 568,253 L 570,251 L 572,251 L 574,253 L 575,255 L 575,258 L 574,260 L 572,262 L 570,262 L 568,261 L 567,259 L 567,256 L 567,254 Z"/>
                                
                                <!-- UK and Ireland -->
                                <path d="M 395,128 L 398,126 L 401,126 L 404,128 L 406,131 L 407,135 L 407,139 L 406,143 L 404,146 L 401,148 L 398,148 L 395,147 L 393,145 L 392,142 L 392,138 L 392,134 L 393,130 Z
                                     M 390,133 L 392,131 L 394,131 L 396,133 L 397,135 L 397,138 L 396,140 L 394,142 L 392,142 L 390,141 L 389,139 L 389,136 L 389,134 Z"/>
                                
                                <!-- Iceland -->
                                <path d="M 378,98 L 380,96 L 383,96 L 385,98 L 386,101 L 386,104 L 385,107 L 383,109 L 380,109 L 378,108 L 377,106 L 377,103 L 377,100 Z"/>
                                
                                <!-- Greenland -->
                                <path d="M 330,55 L 340,52 L 350,52 L 358,55 L 365,60 L 370,67 L 373,75 L 374,84 L 373,93 L 370,101 L 365,108 L 358,113 L 350,116 L 340,116 L 332,113 L 325,108 L 320,101 L 317,93 L 316,84 L 317,75 L 320,67 L 325,60 Z"/>
                                
                                <!-- Caribbean Islands -->
                                <path d="M 280,250 L 282,248 L 284,248 L 286,250 L 287,252 L 287,254 L 286,256 L 284,258 L 282,258 L 280,257 L 279,255 L 279,252 Z
                                     M 290,248 L 292,246 L 294,246 L 296,248 L 297,250 L 297,252 L 296,254 L 294,256 L 292,256 L 290,255 L 289,253 L 289,250 Z"/>
                                
                                <!-- Alaska -->
                                <path d="M 120,120 L 130,115 L 140,113 L 150,115 L 158,120 L 164,127 L 168,135 L 170,144 L 170,153 L 168,161 L 164,168 L 158,173 L 150,176 L 140,176 L 132,173 L 125,168 L 120,161 L 117,153 L 116,144 L 117,135 L 120,127 Z"/>
                                
                                <!-- Hawaii -->
                                <path d="M 155,260 L 157,258 L 159,258 L 161,260 L 162,262 L 162,264 L 161,266 L 159,268 L 157,268 L 155,267 L 154,265 L 154,262 Z"/>
                                
                                <!-- Cuba -->
                                <path d="M 272,245 L 280,243 L 287,244 L 293,246 L 297,249 L 299,253 L 299,257 L 297,261 L 293,264 L 287,266 L 280,267 L 274,266 L 269,264 L 266,261 L 264,257 L 264,253 L 266,249 L 269,246 Z"/>
                            </g>
                            
                            <!-- Flight path (will be drawn dynamically) -->
                            <path id="flightPath" fill="none" stroke="#ffc107" stroke-width="3" stroke-dasharray="10,5" opacity="0.8"/>
                            
                            <!-- Departure marker -->
                            <g id="departureMarker">
                                <circle cx="0" cy="0" r="8" fill="#28a745" stroke="white" stroke-width="2"/>
                                <text x="0" y="-15" text-anchor="middle" fill="white" font-size="14" font-weight="bold" id="departureLabel">Departure</text>
                            </g>
                            
                            <!-- Arrival marker -->
                            <g id="arrivalMarker">
                                <circle cx="0" cy="0" r="8" fill="#dc3545" stroke="white" stroke-width="2"/>
                                <text x="0" y="-15" text-anchor="middle" fill="white" font-size="14" font-weight="bold" id="arrivalLabel">Arrival</text>
                            </g>
                            
                            <!-- Plane -->
                            <text id="plane" x="0" y="0" text-anchor="middle" font-size="32" transform="rotate(0)">‚úàÔ∏è</text>
                        </g>
                        
                        <!-- Globe highlight overlay -->
                        <circle cx="400" cy="250" r="220" fill="url(#globeHighlight)" pointer-events="none"/>
                    </svg>
                </div>

                <!-- Timer -->
                <div class="timer-section">
                    <div class="timer-display" id="timerDisplay">25:00</div>
                    <div class="progress-container">
                        <div class="progress-fill" id="progressFill"></div>
                        <span class="progress-percentage" id="progressPercentage">0%</span>
                    </div>
                </div>

                <!-- Controls -->
                <div class="controls">
                    <button class="btn btn-secondary" id="pauseFlight">‚è∏Ô∏è Pause</button>
                    <button class="btn btn-danger" id="cancelFlight">‚úï Cancel Flight</button>
                </div>
            </section>

            <!-- Info Sections -->
            <div class="info-sections">
                <!-- Achievements -->
                <div class="info-section">
                    <h2>üèÜ Achievements</h2>
                    <div class="achievements-grid" id="achievementsGrid"></div>
                </div>

                <!-- Cities -->
                <div class="info-section">
                    <h2>üåç Cities</h2>
                    <div class="cities-grid" id="citiesGrid"></div>
                </div>
            </div>
        </main>
    </div>

    <script>
// Real-world flight routes with accurate data
const REAL_ROUTES = {
    // Ultra-short flights (30-45 min realistic)
    'mia-fll': {
        from: 'Miami',
        to: 'Fort Lauderdale',
        fromCity: 'miami',
        toCity: 'fortlauderdale',
        distance: 42,
        flightTime: 30,
        departCoords: [310, 260],
        arrivalCoords: [315, 257]
    },
    'lax-san': {
        from: 'Los Angeles',
        to: 'San Diego',
        fromCity: 'losangeles',
        toCity: 'sandiego',
        distance: 180,
        flightTime: 40,
        departCoords: [200, 190],
        arrivalCoords: [195, 205]
    },
    'bos-lga': {
        from: 'Boston',
        to: 'New York',
        fromCity: 'boston',
        toCity: 'newyork',
        distance: 306,
        flightTime: 45,
        departCoords: [320, 155],
        arrivalCoords: [290, 170]
    },
    
    // Short flights (45-75 min realistic)
    'jfk-bos': { 
        from: 'New York', 
        to: 'Boston', 
        fromCity: 'newyork', 
        toCity: 'boston',
        distance: 306,
        flightTime: 65,
        departCoords: [290, 170],
        arrivalCoords: [320, 155]
    },
    'lax-sfo': { 
        from: 'Los Angeles', 
        to: 'San Francisco', 
        fromCity: 'losangeles', 
        toCity: 'sanfrancisco',
        distance: 543,
        flightTime: 85,
        departCoords: [200, 190],
        arrivalCoords: [180, 170]
    },
    'sea-pdx': { 
        from: 'Seattle', 
        to: 'Portland', 
        fromCity: 'seattle', 
        toCity: 'portland',
        distance: 233,
        flightTime: 55,
        departCoords: [165, 155],
        arrivalCoords: [170, 165]
    },
    'ord-dtw': { 
        from: 'Chicago', 
        to: 'Detroit', 
        fromCity: 'chicago', 
        toCity: 'detroit',
        distance: 382,
        flightTime: 75,
        departCoords: [270, 180],
        arrivalCoords: [295, 175]
    },
    'dfw-iah': {
        from: 'Dallas',
        to: 'Houston',
        fromCity: 'dallas',
        toCity: 'houston',
        distance: 362,
        flightTime: 70,
        departCoords: [250, 220],
        arrivalCoords: [265, 235]
    },
    'phx-lax': {
        from: 'Phoenix',
        to: 'Los Angeles',
        fromCity: 'phoenix',
        toCity: 'losangeles',
        distance: 575,
        flightTime: 80,
        departCoords: [215, 210],
        arrivalCoords: [200, 190]
    },
    'den-slc': {
        from: 'Denver',
        to: 'Salt Lake City',
        fromCity: 'denver',
        toCity: 'saltlakecity',
        distance: 630,
        flightTime: 90,
        departCoords: [235, 180],
        arrivalCoords: [195, 175]
    },
    'atl-mco': {
        from: 'Atlanta',
        to: 'Orlando',
        fromCity: 'atlanta',
        toCity: 'orlando',
        distance: 660,
        flightTime: 85,
        departCoords: [300, 220],
        arrivalCoords: [305, 245]
    },
    
    // Medium flights (90-120 min realistic)
    'jfk-ord': {
        from: 'New York',
        to: 'Chicago',
        fromCity: 'newyork',
        toCity: 'chicago',
        distance: 1190,
        flightTime: 140,
        departCoords: [290, 170],
        arrivalCoords: [270, 180]
    },
    'lax-sea': {
        from: 'Los Angeles',
        to: 'Seattle',
        fromCity: 'losangeles',
        toCity: 'seattle',
        distance: 1550,
        flightTime: 160,
        departCoords: [200, 190],
        arrivalCoords: [165, 155]
    },
    'bos-mia': {
        from: 'Boston',
        to: 'Miami',
        fromCity: 'boston',
        toCity: 'miami',
        distance: 2105,
        flightTime: 185,
        departCoords: [320, 155],
        arrivalCoords: [310, 260]
    },
    
    // Longer domestic (2-3 hours realistic)
    'jfk-mia': {
        from: 'New York',
        to: 'Miami',
        fromCity: 'newyork',
        toCity: 'miami',
        distance: 1759,
        flightTime: 175,
        departCoords: [290, 170],
        arrivalCoords: [310, 260]
    },
    'lax-jfk': {
        from: 'Los Angeles',
        to: 'New York',
        fromCity: 'losangeles',
        toCity: 'newyork',
        distance: 3974,
        flightTime: 320,
        departCoords: [200, 190],
        arrivalCoords: [290, 170]
    },
    'sfo-jfk': {
        from: 'San Francisco',
        to: 'New York',
        fromCity: 'sanfrancisco',
        toCity: 'newyork',
        distance: 4140,
        flightTime: 340,
        departCoords: [180, 170],
        arrivalCoords: [290, 170]
    },
    
    // International (6-7 hours realistic)
    'jfk-lhr': { 
        from: 'New York', 
        to: 'London', 
        fromCity: 'newyork', 
        toCity: 'london',
        distance: 5585,
        flightTime: 420,
        departCoords: [290, 170],
        arrivalCoords: [430, 145]
    },
    'jfk-cdg': {
        from: 'New York',
        to: 'Paris',
        fromCity: 'newyork',
        toCity: 'paris',
        distance: 5837,
        flightTime: 440,
        departCoords: [290, 170],
        arrivalCoords: [445, 150]
    },
    'lax-lhr': {
        from: 'Los Angeles',
        to: 'London',
        fromCity: 'losangeles',
        toCity: 'london',
        distance: 8781,
        flightTime: 600,
        departCoords: [200, 190],
        arrivalCoords: [430, 145]
    }
};

// FocusFlight Application
class FocusFlight {
    constructor() {
        this.data = {
            totalMiles: 0,
            flightsCompleted: 0,
            achievements: [],
            unlockedCities: ['newyork', 'boston', 'losangeles', 'sanfrancisco', 'chicago', 'detroit'],
            unlockedSeats: ['economy', 'business']
        };
        
        this.session = {
            active: false,
            paused: false,
            duration: 25,
            elapsed: 0,
            seatClass: 'economy',
            route: 'jfk-bos',
            timer: null,
            startTime: null,
            currentStep: 1,
            selectedDuration: 25,
            selectedSeat: 'economy',
            selectedSeatLabel: '6A',
            selectedRoute: null
        };

        this.achievements = [
            { id: 'first-flight', name: 'First Flight', desc: 'Complete your first focus session', icon: 'üéØ', requirement: 1, type: 'flights' },
            { id: 'frequent-flyer', name: 'Frequent Flyer', desc: 'Complete 10 flights', icon: '‚úàÔ∏è', requirement: 10, type: 'flights' },
            { id: 'globe-trotter', name: 'Globe Trotter', desc: 'Complete 25 flights', icon: 'üåç', requirement: 25, type: 'flights' },
            { id: 'mile-high-club', name: 'Mile High Club', desc: 'Earn 100 miles', icon: 'üíØ', requirement: 100, type: 'miles' },
            { id: 'sky-master', name: 'Sky Master', desc: 'Earn 500 miles', icon: '‚≠ê', requirement: 500, type: 'miles' },
            { id: 'aviation-legend', name: 'Aviation Legend', desc: 'Earn 1000 miles', icon: 'üëë', requirement: 1000, type: 'miles' }
        ];

        this.cities = [
            { id: 'newyork', name: 'New York', icon: 'üóΩ', requirement: 0 },
            { id: 'boston', name: 'Boston', icon: 'üèõÔ∏è', requirement: 0 },
            { id: 'sanfrancisco', name: 'San Francisco', icon: 'üåâ', requirement: 0 },
            { id: 'losangeles', name: 'Los Angeles', icon: 'üå¥', requirement: 0 },
            { id: 'chicago', name: 'Chicago', icon: 'üèôÔ∏è', requirement: 0 },
            { id: 'detroit', name: 'Detroit', icon: 'üöó', requirement: 0 },
            { id: 'sandiego', name: 'San Diego', icon: '‚õ±Ô∏è', requirement: 50 },
            { id: 'fortlauderdale', name: 'Fort Lauderdale', icon: 'üèñÔ∏è', requirement: 100 },
            { id: 'miami', name: 'Miami', icon: 'üå∫', requirement: 100 },
            { id: 'phoenix', name: 'Phoenix', icon: 'üåµ', requirement: 150 },
            { id: 'denver', name: 'Denver', icon: '‚õ∞Ô∏è', requirement: 200 },
            { id: 'saltlakecity', name: 'Salt Lake City', icon: 'üèîÔ∏è', requirement: 200 },
            { id: 'seattle', name: 'Seattle', icon: '‚òï', requirement: 250 },
            { id: 'portland', name: 'Portland', icon: 'üå≤', requirement: 250 },
            { id: 'atlanta', name: 'Atlanta', icon: 'üçë', requirement: 250 },
            { id: 'orlando', name: 'Orlando', icon: 'üé¢', requirement: 250 },
            { id: 'dallas', name: 'Dallas', icon: 'ü§†', requirement: 300 },
            { id: 'houston', name: 'Houston', icon: 'üöÄ', requirement: 300 },
            { id: 'london', name: 'London', icon: 'üá¨üáß', requirement: 500 },
            { id: 'paris', name: 'Paris', icon: 'üá´üá∑', requirement: 500 }
        ];

        this.durations = [
            { value: 15, label: 'Quick Sprint', category: 'short' },
            { value: 25, label: 'Pomodoro', category: 'short' },
            { value: 30, label: 'Half Hour', category: 'medium' },
            { value: 45, label: 'Power Hour', category: 'medium' },
            { value: 60, label: 'Deep Work', category: 'long' },
            { value: 90, label: 'Extended', category: 'long' },
            { value: 120, label: 'Ultra Focus', category: 'transcontinental' }
        ];

        this.seats = [
            { id: 'economy', name: 'Economy', icon: 'üí∫', multiplier: 1, requirement: 0 },
            { id: 'business', name: 'Business', icon: 'üõãÔ∏è', multiplier: 1.5, requirement: 0 },
            { id: 'first', name: 'First Class', icon: 'üëë', multiplier: 2, requirement: 500 }
        ];

        this.init();
    }

    init() {
        this.loadData();
        this.updateUI();
        this.renderDurations();
        this.renderSeats();
        this.renderAchievements();
        this.renderCities();
        this.attachEventListeners();
        this.checkUnlocks();
    }

    loadData() {
        const saved = localStorage.getItem('focusFlightV2');
        if (saved) {
            try {
                const parsed = JSON.parse(saved);
                this.data = { ...this.data, ...parsed };
            } catch (e) {
                console.error('Error loading data:', e);
            }
        }
    }

    saveData() {
        localStorage.setItem('focusFlightV2', JSON.stringify(this.data));
    }

    updateUI() {
        document.getElementById('totalMiles').textContent = this.data.totalMiles;
        document.getElementById('flightsCompleted').textContent = this.data.flightsCompleted;
    }

    attachEventListeners() {
        document.getElementById('continueToFlights').addEventListener('click', () => this.goToStep(2));
        document.getElementById('backToDuration').addEventListener('click', () => this.goToStep(1));
        document.getElementById('continueToSeats').addEventListener('click', () => this.goToStep(3));
        document.getElementById('backToFlights').addEventListener('click', () => this.goToStep(2));
        document.getElementById('startFlight').addEventListener('click', () => this.startFlight());
        document.getElementById('pauseFlight').addEventListener('click', () => this.togglePause());
        document.getElementById('cancelFlight').addEventListener('click', () => this.cancelFlight());
    }

    renderDurations() {
        const grid = document.getElementById('durationGrid');
        grid.innerHTML = '';
        
        this.durations.forEach(duration => {
            const card = document.createElement('div');
            card.className = 'duration-card';
            if (duration.value === this.session.selectedDuration) {
                card.classList.add('selected');
            }
            
            card.innerHTML = `
                <div class="duration-time">${duration.value}<span style="font-size: 0.5em;">min</span></div>
                <div class="duration-label">${duration.label}</div>
            `;
            
            card.addEventListener('click', () => {
                this.session.selectedDuration = duration.value;
                document.querySelectorAll('.duration-card').forEach(c => c.classList.remove('selected'));
                card.classList.add('selected');
            });
            
            grid.appendChild(card);
        });
    }

    renderSeats() {
        const seatMap = document.getElementById('seatMap');
        seatMap.innerHTML = '';
        
        // Define seat configuration for each class
        const seatConfig = {
            first: {
                rows: [1, 2],
                columns: ['A', 'C', 'D', 'F'],
                perks: ['Extra legroom', 'Premium meals', '2x miles'],
                multiplier: 2,
                requirement: 500
            },
            business: {
                rows: [3, 4, 5],
                columns: ['A', 'B', 'C', 'D', 'E', 'F'],
                perks: ['Priority boarding', 'Lounge access', '1.5x miles'],
                multiplier: 1.5,
                requirement: 0
            },
            economy: {
                rows: [6, 7, 8, 9, 10],
                columns: ['A', 'B', 'C', 'D', 'E', 'F'],
                perks: ['Standard service', '1x miles'],
                multiplier: 1,
                requirement: 0
            }
        };
        
        // Generate random occupied seats (for realism)
        const occupiedSeats = this.generateOccupiedSeats();
        
        // Render each class section
        ['first', 'business', 'economy'].forEach(classType => {
            const config = seatConfig[classType];
            const unlocked = this.data.totalMiles >= config.requirement;
            
            const section = document.createElement('div');
            section.className = `seat-class-section ${classType}${!unlocked ? ' locked' : ''}`;
            
            const header = document.createElement('div');
            header.className = `class-header ${classType}`;
            header.innerHTML = `
                <span class="class-title">${classType === 'first' ? 'üëë First Class' : classType === 'business' ? 'üõãÔ∏è Business Class' : 'üí∫ Economy Class'}</span>
                <span class="class-multiplier">${config.multiplier}x Miles</span>
                ${!unlocked ? `<span style="margin-left: auto; color: #dc3545; font-weight: 700;">üîí ${config.requirement} miles required</span>` : ''}
            `;
            section.appendChild(header);
            
            const rows = document.createElement('div');
            rows.className = 'seat-rows';
            
            config.rows.forEach(rowNum => {
                const row = document.createElement('div');
                row.className = 'seat-row';
                
                // Row number
                const rowLabel = document.createElement('div');
                rowLabel.className = 'row-number';
                rowLabel.textContent = rowNum;
                row.appendChild(rowLabel);
                
                // Left seats
                const leftGroup = document.createElement('div');
                leftGroup.className = 'seat-group';
                config.columns.slice(0, Math.floor(config.columns.length / 2)).forEach(col => {
                    const seat = this.createSeat(rowNum, col, classType, config, occupiedSeats, unlocked);
                    leftGroup.appendChild(seat);
                });
                row.appendChild(leftGroup);
                
                // Aisle
                const aisle = document.createElement('div');
                aisle.className = 'aisle';
                row.appendChild(aisle);
                
                // Right seats
                const rightGroup = document.createElement('div');
                rightGroup.className = 'seat-group';
                config.columns.slice(Math.floor(config.columns.length / 2)).forEach(col => {
                    const seat = this.createSeat(rowNum, col, classType, config, occupiedSeats, unlocked);
                    rightGroup.appendChild(seat);
                });
                row.appendChild(rightGroup);
                
                rows.appendChild(row);
            });
            
            section.appendChild(rows);
            seatMap.appendChild(section);
        });
    }
    
    generateOccupiedSeats() {
        // Generate a realistic distribution of occupied seats
        const occupied = new Set();
        const occupancyRate = 0.3; // 30% of seats occupied
        
        for (let row = 1; row <= 10; row++) {
            ['A', 'B', 'C', 'D', 'E', 'F'].forEach(col => {
                if (Math.random() < occupancyRate) {
                    occupied.add(`${row}${col}`);
                }
            });
        }
        
        return occupied;
    }
    
    createSeat(row, col, classType, config, occupiedSeats, unlocked) {
        const seatLabel = `${row}${col}`;
        const isOccupied = occupiedSeats.has(seatLabel);
        const isSelected = this.session.selectedSeatLabel === seatLabel;
        
        const seat = document.createElement('div');
        seat.className = `seat ${classType}`;
        seat.setAttribute('data-label', seatLabel);
        seat.setAttribute('data-class', classType);
        
        if (isOccupied) {
            seat.classList.add('occupied');
        } else if (unlocked) {
            seat.classList.add('available');
            if (isSelected) {
                seat.classList.add('selected');
            }
        } else {
            seat.classList.add('occupied');
        }
        
        // Add tooltip
        if (!isOccupied && unlocked) {
            const tooltip = document.createElement('div');
            tooltip.className = 'seat-tooltip';
            tooltip.innerHTML = `
                <strong>Seat ${seatLabel}</strong><br>
                ${config.perks.join(' ‚Ä¢ ')}
            `;
            seat.appendChild(tooltip);
        }
        
        // Add click handler
        if (!isOccupied && unlocked) {
            seat.addEventListener('click', () => {
                // Remove previous selection
                document.querySelectorAll('.seat.selected').forEach(s => s.classList.remove('selected'));
                
                // Select this seat
                seat.classList.add('selected');
                this.session.selectedSeat = classType;
                this.session.selectedSeatLabel = seatLabel;
                
                // Show selected seat info
                this.showSelectedSeatInfo(seatLabel, classType, config);
            });
        }
        
        return seat;
    }
    
    showSelectedSeatInfo(seatLabel, classType, config) {
        const infoDiv = document.getElementById('selectedSeatInfo');
        const detailsDiv = document.getElementById('seatDetails');
        const perksDiv = document.getElementById('seatPerks');
        
        const className = classType === 'first' ? 'First Class' : 
                         classType === 'business' ? 'Business Class' : 'Economy Class';
        
        detailsDiv.textContent = `Seat ${seatLabel} - ${className} (${config.multiplier}x miles)`;
        perksDiv.innerHTML = `‚ú® ${config.perks.join(' ‚Ä¢ ')}`;
        
        infoDiv.style.display = 'block';
        
        // Smooth scroll to show the info
        infoDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }

    renderRoutes() {
        const grid = document.getElementById('routesGrid');
        grid.innerHTML = '';
        
        const duration = this.session.selectedDuration;
        const recommendedRoutes = this.getRecommendedRoutes(duration);
        
        Object.entries(REAL_ROUTES).forEach(([id, route]) => {
            const fromUnlocked = this.data.unlockedCities.includes(route.fromCity);
            const toUnlocked = this.data.unlockedCities.includes(route.toCity);
            const unlocked = fromUnlocked && toUnlocked;
            const recommended = recommendedRoutes.includes(id);
            
            const card = document.createElement('div');
            card.className = `route-card${!unlocked ? ' locked' : ''}${recommended ? ' recommended' : ''}`;
            if (id === this.session.selectedRoute && unlocked) {
                card.classList.add('selected');
            }
            
            card.innerHTML = `
                <div class="route-cities">
                    ${route.from}<span class="route-arrow">‚Üí</span>${route.to}
                </div>
                <div class="route-info">
                    <div class="route-info-item">
                        <div class="route-info-label">Distance</div>
                        <div class="route-info-value">${route.distance} km</div>
                    </div>
                    <div class="route-info-item">
                        <div class="route-info-label">Flight Time</div>
                        <div class="route-info-value">${Math.floor(route.flightTime / 60)}h ${route.flightTime % 60}m</div>
                    </div>
                </div>
                ${!unlocked ? '<div class="locked-badge">üîí Unlock cities to fly this route</div>' : ''}
            `;
            
            if (unlocked) {
                card.addEventListener('click', () => {
                    this.session.selectedRoute = id;
                    document.querySelectorAll('.route-card').forEach(c => c.classList.remove('selected'));
                    card.classList.add('selected');
                });
            }
            
            grid.appendChild(card);
        });
    }

    getRecommendedRoutes(duration) {
        // Suggest realistic routes based on focus duration
        const recommended = [];
        Object.entries(REAL_ROUTES).forEach(([id, route]) => {
            const ratio = duration / route.flightTime;
            // Recommend if duration is within 20-40% of actual flight time (realistic compression)
            if (ratio >= 0.15 && ratio <= 0.50) {
                recommended.push(id);
            }
        });
        return recommended;
    }

    goToStep(step) {
        // Hide all steps with fade out
        const steps = [
            document.getElementById('step1Content'),
            document.getElementById('step2Content'),
            document.getElementById('step3Content')
        ];
        
        steps.forEach(s => {
            s.style.opacity = '0';
            s.style.transform = 'translateY(30px)';
        });
        
        setTimeout(() => {
            steps.forEach(s => s.classList.add('hidden'));
            
            // Update step indicators
            document.getElementById('step1Dot').classList.remove('active', 'completed');
            document.getElementById('step2Dot').classList.remove('active', 'completed');
            document.getElementById('step3Dot').classList.remove('active', 'completed');
            document.getElementById('connector1').classList.remove('completed');
            document.getElementById('connector2').classList.remove('completed');
            
            // Mark completed steps
            if (step > 1) {
                document.getElementById('step1Dot').classList.add('completed');
                document.getElementById('connector1').classList.add('completed');
            }
            if (step > 2) {
                document.getElementById('step2Dot').classList.add('completed');
                document.getElementById('connector2').classList.add('completed');
            }
            
            // Show current step
            document.getElementById(`step${step}Dot`).classList.add('active');
            const currentStep = document.getElementById(`step${step}Content`);
            currentStep.classList.remove('hidden');
            
            // Trigger animation
            setTimeout(() => {
                currentStep.style.opacity = '1';
                currentStep.style.transform = 'translateY(0)';
            }, 50);
            
            // Special handling for step 2 (flights need rendering with current duration)
            if (step === 2) {
                this.renderRoutes();
                const duration = this.session.selectedDuration;
                const message = document.getElementById('flightFilterMessage');
                message.textContent = `Showing flights suitable for ${duration} minute focus session`;
            }
            
            // Special handling for step 3 (re-render seats for clean state)
            if (step === 3) {
                this.renderSeats();
            }
            
            this.session.currentStep = step;
        }, 300);
    }

    getSeatMultiplier(seatClass) {
        const seat = this.seats.find(s => s.id === seatClass);
        return seat ? seat.multiplier : 1;
    }

    startFlight() {
        if (!this.session.selectedRoute) {
            alert('Please select a route first!');
            return;
        }
        
        if (!this.session.selectedSeat) {
            alert('Please select a seat first!');
            return;
        }

        const duration = this.session.selectedDuration; // Use the selected time duration
        const seatClass = this.session.selectedSeat;
        const route = REAL_ROUTES[this.session.selectedRoute];

        this.session = {
            ...this.session,
            active: true,
            paused: false,
            duration: duration,
            elapsed: 0,
            seatClass: seatClass,
            route: this.session.selectedRoute,
            timer: null,
            startTime: Date.now()
        };

        // Hide booking, show tracker
        document.getElementById('bookingSteps').classList.add('hidden');
        document.getElementById('flightTracker').classList.remove('hidden');

        // Update flight info
        document.getElementById('flightRouteTitle').textContent = `${route.from} ‚Üí ${route.to}`;
        document.getElementById('flightClass').textContent = seatClass.charAt(0).toUpperCase() + seatClass.slice(1);
        document.getElementById('flightDistance').textContent = `${route.distance} km`;
        
        const baseMiles = duration;
        const multiplier = this.getSeatMultiplier(seatClass);
        const totalMiles = Math.round(baseMiles * multiplier);
        document.getElementById('milesToEarn').textContent = totalMiles;

        // Update globe visualization
        this.updateGlobeVisualization(route);

        // Start the timer
        this.runTimer();
    }

    updateGlobeVisualization(route) {
        const [x1, y1] = route.departCoords;
        const [x2, y2] = route.arrivalCoords;
        
        // Update departure marker
        const departMarker = document.getElementById('departureMarker');
        departMarker.setAttribute('transform', `translate(${x1}, ${y1})`);
        document.getElementById('departureLabel').textContent = route.from;
        
        // Update arrival marker
        const arrivalMarker = document.getElementById('arrivalMarker');
        arrivalMarker.setAttribute('transform', `translate(${x2}, ${y2})`);
        document.getElementById('arrivalLabel').textContent = route.to;
        
        // Calculate great-circle path for realistic flight route
        const flightPath = this.calculateGreatCirclePath(x1, y1, x2, y2);
        document.getElementById('flightPath').setAttribute('d', flightPath);
        
        // Calculate zoom and pan to focus on route
        this.animateZoomToRoute(x1, y1, x2, y2);
        
        // Position plane at start
        const plane = document.getElementById('plane');
        plane.setAttribute('x', x1);
        plane.setAttribute('y', y1);
    }
    
    calculateGreatCirclePath(x1, y1, x2, y2) {
        // Calculate a more realistic curved path simulating great-circle route
        const dx = x2 - x1;
        const dy = y2 - y1;
        const distance = Math.sqrt(dx * dx + dy * dy);
        
        // Number of segments for smooth curve
        const segments = Math.max(20, Math.floor(distance / 10));
        let path = `M ${x1},${y1}`;
        
        // Calculate control points for a realistic arc
        // The arc height depends on the distance
        const arcHeight = distance * 0.2;
        
        // Determine arc direction (upward for eastward flights, adjust for others)
        const midX = (x1 + x2) / 2;
        const midY = (y1 + y2) / 2;
        
        // Calculate perpendicular offset for arc
        const perpX = -dy / distance;
        const perpY = dx / distance;
        
        // Create smooth bezier curve with multiple control points for great-circle effect
        const controlPoints = [];
        for (let i = 0; i <= segments; i++) {
            const t = i / segments;
            
            // Quadratic interpolation along the path
            const baseX = x1 + dx * t;
            const baseY = y1 + dy * t;
            
            // Apply sinusoidal arc for great-circle effect
            const arcOffset = Math.sin(t * Math.PI) * arcHeight;
            const ptX = baseX + perpX * arcOffset;
            const ptY = baseY + perpY * arcOffset;
            
            controlPoints.push({ x: ptX, y: ptY });
        }
        
        // Create smooth path through control points
        for (let i = 1; i < controlPoints.length; i++) {
            path += ` L ${controlPoints[i].x},${controlPoints[i].y}`;
        }
        
        return path;
    }
    
    animateZoomToRoute(x1, y1, x2, y2) {
        const mapContent = document.getElementById('mapContent');
        
        // Calculate bounding box of the route
        const minX = Math.min(x1, x2);
        const maxX = Math.max(x1, x2);
        const minY = Math.min(y1, y2);
        const maxY = Math.max(y1, y2);
        
        // Add padding
        const padding = 80;
        const routeWidth = maxX - minX + padding * 2;
        const routeHeight = maxY - minY + padding * 2;
        const routeCenterX = (minX + maxX) / 2;
        const routeCenterY = (minY + maxY) / 2;
        
        // Globe viewport dimensions
        const globeCenterX = 400;
        const globeCenterY = 250;
        const viewportWidth = 440; // Diameter of globe
        const viewportHeight = 440;
        
        // Calculate zoom level to fit the route
        const scaleX = viewportWidth / routeWidth;
        const scaleY = viewportHeight / routeHeight;
        const scale = Math.min(scaleX, scaleY, 2.5); // Limit max zoom to 2.5x
        
        // Calculate translation to center the route
        const translateX = (globeCenterX - routeCenterX) * scale;
        const translateY = (globeCenterY - routeCenterY) * scale;
        
        // Apply smooth zoom and pan animation
        mapContent.style.transform = `translate(${translateX}px, ${translateY}px) scale(${scale})`;
    }
    
    resetGlobeZoom() {
        const mapContent = document.getElementById('mapContent');
        mapContent.style.transform = 'translate(0, 0) scale(1)';
    }

    runTimer() {
        const updateInterval = 100;
        
        this.session.timer = setInterval(() => {
            if (!this.session.paused) {
                this.session.elapsed += updateInterval / 1000;
                
                const remainingSeconds = Math.max(0, this.session.duration * 60 - this.session.elapsed);
                const minutes = Math.floor(remainingSeconds / 60);
                const seconds = Math.floor(remainingSeconds % 60);
                
                document.getElementById('timerDisplay').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                // Update progress
                const progress = (this.session.elapsed / (this.session.duration * 60)) * 100;
                const progressClamped = Math.min(progress, 100);
                document.getElementById('progressFill').style.width = `${progressClamped}%`;
                document.getElementById('progressPercentage').textContent = `${Math.round(progressClamped)}%`;
                
                // Animate plane along path
                this.animatePlane(progressClamped / 100);
                
                if (remainingSeconds <= 0) {
                    this.completeFlight();
                }
            }
        }, updateInterval);
    }

    animatePlane(progress) {
        const route = REAL_ROUTES[this.session.route];
        const [x1, y1] = route.departCoords;
        const [x2, y2] = route.arrivalCoords;
        
        // Calculate position along the great-circle path
        const dx = x2 - x1;
        const dy = y2 - y1;
        const distance = Math.sqrt(dx * dx + dy * dy);
        
        // Arc parameters matching the flight path calculation
        const arcHeight = distance * 0.2;
        const perpX = -dy / distance;
        const perpY = dx / distance;
        
        // Calculate plane position
        const t = progress;
        const baseX = x1 + dx * t;
        const baseY = y1 + dy * t;
        const arcOffset = Math.sin(t * Math.PI) * arcHeight;
        const planeX = baseX + perpX * arcOffset;
        const planeY = baseY + perpY * arcOffset;
        
        // Calculate angle for plane rotation based on path tangent
        const nextT = Math.min(t + 0.01, 1);
        const nextBaseX = x1 + dx * nextT;
        const nextBaseY = y1 + dy * nextT;
        const nextArcOffset = Math.sin(nextT * Math.PI) * arcHeight;
        const nextX = nextBaseX + perpX * nextArcOffset;
        const nextY = nextBaseY + perpY * nextArcOffset;
        
        const angle = Math.atan2(nextY - planeY, nextX - planeX) * 180 / Math.PI;
        
        const plane = document.getElementById('plane');
        plane.setAttribute('x', planeX);
        plane.setAttribute('y', planeY);
        plane.setAttribute('transform', `rotate(${angle} ${planeX} ${planeY})`);
    }

    togglePause() {
        this.session.paused = !this.session.paused;
        const btn = document.getElementById('pauseFlight');
        btn.textContent = this.session.paused ? '‚ñ∂Ô∏è Resume' : '‚è∏Ô∏è Pause';
    }

    cancelFlight() {
        if (confirm('Are you sure you want to cancel this flight? You will not earn any miles.')) {
            this.endFlight(false);
        }
    }

    completeFlight() {
        this.endFlight(true);
    }

    endFlight(completed) {
        clearInterval(this.session.timer);
        
        // Reset globe zoom
        this.resetGlobeZoom();
        
        if (completed) {
            const baseMiles = this.session.duration;
            const multiplier = this.getSeatMultiplier(this.session.seatClass);
            const earnedMiles = Math.round(baseMiles * multiplier);
            
            this.data.totalMiles += earnedMiles;
            this.data.flightsCompleted += 1;
            
            this.saveData();
            this.updateUI();
            this.checkAchievements();
            this.checkUnlocks();
            this.renderAchievements();
            this.renderCities();
            
            alert(`üéâ Flight Completed!\n\nYou earned ${earnedMiles} miles!\nTotal Miles: ${this.data.totalMiles}`);
        }
        
        // Reset to booking
        document.getElementById('bookingSteps').classList.remove('hidden');
        document.getElementById('flightTracker').classList.add('hidden');
        this.goToStep(1);
        
        // Reset selections
        this.session.selectedRoute = null;
        this.session.active = false;
    }

    checkAchievements() {
        this.achievements.forEach(achievement => {
            if (!this.data.achievements.includes(achievement.id)) {
                const value = achievement.type === 'flights' ? this.data.flightsCompleted : this.data.totalMiles;
                if (value >= achievement.requirement) {
                    this.data.achievements.push(achievement.id);
                    this.showAchievementNotification(achievement);
                }
            }
        });
    }

    showAchievementNotification(achievement) {
        setTimeout(() => {
            alert(`üèÜ Achievement Unlocked!\n\n${achievement.icon} ${achievement.name}\n${achievement.desc}`);
        }, 500);
    }

    checkUnlocks() {
        // Check seat unlocks
        if (this.data.totalMiles >= 500 && !this.data.unlockedSeats.includes('first')) {
            this.data.unlockedSeats.push('first');
        }
        
        // Check city unlocks
        this.cities.forEach(city => {
            if (this.data.totalMiles >= city.requirement && !this.data.unlockedCities.includes(city.id)) {
                this.data.unlockedCities.push(city.id);
            }
        });
    }

    renderAchievements() {
        const grid = document.getElementById('achievementsGrid');
        grid.innerHTML = '';
        
        this.achievements.forEach(achievement => {
            const unlocked = this.data.achievements.includes(achievement.id);
            const card = document.createElement('div');
            card.className = `achievement-card ${unlocked ? 'unlocked' : 'locked'}`;
            
            const value = achievement.type === 'flights' ? this.data.flightsCompleted : this.data.totalMiles;
            const progress = unlocked ? '' : `<div class="achievement-desc">${value}/${achievement.requirement}</div>`;
            
            card.innerHTML = `
                <div class="achievement-icon">${achievement.icon}</div>
                <div class="achievement-name">${achievement.name}</div>
                <div class="achievement-desc">${achievement.desc}</div>
                ${progress}
            `;
            
            grid.appendChild(card);
        });
    }

    renderCities() {
        const grid = document.getElementById('citiesGrid');
        grid.innerHTML = '';
        
        this.cities.forEach(city => {
            const unlocked = this.data.unlockedCities.includes(city.id);
            const card = document.createElement('div');
            card.className = `city-card ${unlocked ? 'unlocked' : 'locked'}`;
            
            card.innerHTML = `
                <div class="city-icon">${city.icon}</div>
                <div class="city-name">${city.name}</div>
                ${!unlocked ? `<div class="city-requirement">üîí ${city.requirement} miles</div>` : ''}
            `;
            
            grid.appendChild(card);
        });
    }
}

// Initialize the app
document.addEventListener('DOMContentLoaded', () => {
    new FocusFlight();
});
    </script>
</body>
</html>
